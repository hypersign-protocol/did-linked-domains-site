{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.typed-array.to-reversed.js\");\nrequire(\"core-js/modules/es.typed-array.to-sorted.js\");\nrequire(\"core-js/modules/es.typed-array.with.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * Copyright (c) 2023, Hypermine Pvt. Ltd.\n * All rights reserved.\n * Author: Hypermine Core Team\n */\nconst constant = __importStar(require(\"../constants\"));\nconst jsonld_signatures_1 = __importDefault(require(\"jsonld-signatures\"));\nconst {\n  AuthenticationProofPurpose\n} = jsonld_signatures_1.default.purposes;\nconst didRPC_1 = require(\"./didRPC\");\nconst utils_1 = __importDefault(require(\"../utils\"));\nconst ed25519 = require('@stablelib/ed25519');\nconst did_1 = require(\"../../libs/generated/ssi/did\");\nconst ed25519_verification_key_2020_1 = require(\"@digitalbazaar/ed25519-verification-key-2020\");\nconst ed25519_signature_2020_1 = require(\"@digitalbazaar/ed25519-signature-2020\");\nconst web3_1 = __importDefault(require(\"web3\"));\nconst IDID_1 = require(\"./IDID\");\nconst v1_1 = __importDefault(require(\"../../libs/w3cache/v1\"));\nclass DIDDocument {\n  constructor(publicKey, blockchainAccountId, id, keyType, verificationRelationships) {\n    let vm;\n    switch (keyType) {\n      case IDID_1.IKeyType.Ed25519VerificationKey2020:\n        {\n          this.context = [constant['DID_' + keyType].DID_BASE_CONTEXT];\n          this.id = id;\n          this.controller = [this.id];\n          this.alsoKnownAs = [this.id];\n          vm = {\n            id: this.id + '#key-1',\n            type: constant['DID_' + keyType].VERIFICATION_METHOD_TYPE,\n            controller: this.id,\n            publicKeyMultibase: publicKey,\n            blockchainAccountId: ''\n          };\n          const verificationMethod = vm;\n          this.verificationMethod = [verificationMethod];\n          this.authentication = [];\n          this.assertionMethod = [];\n          this.keyAgreement = [];\n          this.capabilityInvocation = [];\n          this.capabilityDelegation = [];\n          verificationRelationships === null || verificationRelationships === void 0 ? void 0 : verificationRelationships.forEach(value => {\n            this[value] = [verificationMethod.id];\n          });\n          // TODO: we should take services object in consntructor\n          this.service = [];\n          break;\n        }\n      case IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020:\n        {\n          this.context = [constant['DID_' + keyType].DID_BASE_CONTEXT];\n          this.id = id;\n          this.controller = [this.id];\n          this.alsoKnownAs = [this.id];\n          vm = {\n            id: this.id + '#key-1',\n            type: constant['DID_' + keyType].VERIFICATION_METHOD_TYPE,\n            controller: this.id,\n            blockchainAccountId: blockchainAccountId\n          };\n          const verificationMethod = vm;\n          this.verificationMethod = [verificationMethod];\n          this.authentication = [];\n          this.assertionMethod = [];\n          this.keyAgreement = [];\n          this.capabilityInvocation = [];\n          this.capabilityDelegation = [];\n          verificationRelationships === null || verificationRelationships === void 0 ? void 0 : verificationRelationships.forEach(value => {\n            this[value] = [verificationMethod.id];\n          });\n          // TODO: we should take services object in consntructor\n          this.service = [];\n          break;\n        }\n      case IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019:\n        {\n          this.context = [constant['DID_' + keyType].DID_BASE_CONTEXT];\n          this.id = id;\n          this.controller = [this.id];\n          this.alsoKnownAs = [];\n          vm = {\n            id: this.id + '#key-1',\n            type: constant['DID_' + keyType].VERIFICATION_METHOD_TYPE,\n            controller: this.id,\n            publicKeyMultibase: publicKey,\n            blockchainAccountId: blockchainAccountId\n          };\n          const verificationMethod = vm;\n          this.verificationMethod = [verificationMethod];\n          this.authentication = [];\n          this.assertionMethod = [];\n          this.keyAgreement = [];\n          this.capabilityInvocation = [];\n          this.capabilityDelegation = [];\n          verificationRelationships === null || verificationRelationships === void 0 ? void 0 : verificationRelationships.forEach(value => {\n            this[value] = [verificationMethod.id];\n          });\n          // TODO: we should take services object in consntructor\n          this.service = [];\n          break;\n        }\n      default:\n        throw new Error('Invalid');\n    }\n  }\n}\n/** Class representing HypersignDID */\nclass HypersignDID {\n  /**\n   * Creates instance of HypersignDID class\n   * @constructor\n   * @params\n   *  - params.namespace        : namespace of did id, Default 'did:hid'\n   *  - params.offlineSigner    : signer of type OfflineSigner\n   *  - params.nodeRpcEndpoint  : RPC endpoint of the Hypersign blockchain, Default 'TEST'\n   *  - params.nodeRestEndpoint : REST endpoint of the Hypersign blockchain\n   */\n  constructor(params = {}) {\n    this._getId = methodSpecificId => {\n      if (methodSpecificId && methodSpecificId.length < 32) {\n        throw new Error('HID-SSI-SDK:: Error: methodSpecificId should be of minimum size 32');\n      }\n      let did = '';\n      did = this.namespace && this.namespace != '' ? `${constant.DID.SCHEME}:${constant.DID.METHOD}:${this.namespace}:${methodSpecificId}` : `${constant.DID.SCHEME}:${constant.DID.METHOD}:${methodSpecificId}`;\n      return did;\n    };\n    this._isValidMultibaseBase58String = str => {\n      const multibaseBase58Regex = /^z([1-9A-HJ-NP-Za-km-z]+)$/;\n      return multibaseBase58Regex.test(str);\n    };\n    const {\n      offlineSigner,\n      namespace,\n      nodeRpcEndpoint,\n      nodeRestEndpoint\n    } = params;\n    const nodeRPCEp = nodeRpcEndpoint ? nodeRpcEndpoint : 'MAIN';\n    const nodeRestEp = nodeRestEndpoint ? nodeRestEndpoint : '';\n    const rpcConstructorParams = {\n      offlineSigner,\n      nodeRpcEndpoint: nodeRPCEp,\n      nodeRestEndpoint: nodeRestEp\n    };\n    this.didrpc = new didRPC_1.DIDRpc(rpcConstructorParams);\n    this.namespace = namespace ? namespace : '';\n  }\n  _sign(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const {\n        privateKeyMultibase: privateKeyMultibaseConverted\n      } = utils_1.default.convertEd25519verificationkey2020toStableLibKeysInto({\n        privKey: params.privateKeyMultibase\n      });\n      const {\n        didDocString\n      } = params;\n      // TODO:  do proper checck of paramaters\n      const did = JSON.parse(didDocString);\n      const didBytes = (yield did_1.Did.encode(did)).finish();\n      const signed = ed25519.sign(privateKeyMultibaseConverted, didBytes);\n      return Buffer.from(signed).toString('base64');\n    });\n  }\n  /**\n   * SignDid method is used to sign the did document\n   * @param params\n   * - params.didDocString: stringified did document\n   * - params.privateKeyMultibase: private key of the did document\n   * @returns string\n   **/\n  signDid(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const didDoc = utils_1.default.ldToJsonConvertor(params.didDocument);\n      const didDocString = JSON.stringify(didDoc);\n      return yield this._sign({\n        didDocString,\n        privateKeyMultibase: params.privateKeyMultibase\n      });\n    });\n  }\n  _filterVerificationRelationships(verificationRelationships) {\n    let vR = [IDID_1.IVerificationRelationships.assertionMethod, IDID_1.IVerificationRelationships.authentication, IDID_1.IVerificationRelationships.capabilityDelegation, IDID_1.IVerificationRelationships.capabilityInvocation];\n    if (verificationRelationships && verificationRelationships.length > 0) {\n      const set1 = new Set(vR);\n      const set2 = new Set(verificationRelationships);\n      vR = Array.from(set1).filter(value => set2.has(value));\n    }\n    return vR;\n  }\n  /**\n   * Creates a new DID Document from wallet address\n   * @params\n   *  - params.blockChainAccountId  :\n   *  - params.methodSpecificId   : methodSpecificId (min 32 bit alhanumeric) else it will generate new random methodSpecificId or may be walletaddress\n   * @returns {Promise<object>} DidDocument object\n   */\n  _getBlockChainAccountID(chainId, address) {\n    try {\n      const web3 = new web3_1.default();\n      const inDecimelChainId = web3.utils.hexToNumber(chainId);\n      const blockChainAccountId = constant.CAIP_10_PREFIX.eip155 + ':' + inDecimelChainId + ':' + address;\n      return blockChainAccountId;\n    } catch (error) {\n      throw new Error('HID-SSI-SDK:: Error: unsupported chain Id');\n    }\n  }\n  init() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.didrpc) {\n        throw new Error('HID-SSI-SDK:: Error:  HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n      }\n      yield this.didrpc.init();\n    });\n  }\n  /**\n   * Generate a new key pair of type Ed25519VerificationKey2020\n   * @params params.seed - Optional, Seed to generate the key pair, if not passed, random seed will be taken\n   * @params params.controller - Optional, controller field\n   * @returns {Promise<object>} The key pair of type Ed25519\n   */\n  generateKeys(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let edKeyPair;\n      if (params && params.seed && params.controller) {\n        const seedBytes = new Uint8Array(Buffer.from(params.seed));\n        edKeyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.generate({\n          seed: seedBytes,\n          id: params.controller\n        });\n      } else if (params && params.controller) {\n        edKeyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.generate({\n          id: params.controller\n        });\n      } else if (params && params.seed) {\n        const seedBytes = new Uint8Array(Buffer.from(params.seed));\n        edKeyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.generate({\n          seed: seedBytes\n        });\n      } else {\n        edKeyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.generate();\n      }\n      const exportedKp = yield edKeyPair.export({\n        publicKey: true,\n        privateKey: true\n      });\n      return Object.assign({}, exportedKp);\n    });\n  }\n  /**\n   * Generates a new DID Document\n   * @params\n   *  - params.publicKeyMultibase : public key\n   *  - params.methodSpecificId   : Optional methodSpecificId (min 32 bit alhanumeric) else it will generate new random methodSpecificId\n   *  - params.verificationRelationships: Optional, verification relationships where you want to add your verificaiton method ids\n   * @returns {Promise<object>} DidDocument object\n   */\n  generate(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let verificationRelationships = [];\n      if (params.verificationRelationships && params.verificationRelationships.length > 0) {\n        if (params.verificationRelationships.includes(IDID_1.IVerificationRelationships.keyAgreement)) {\n          throw new Error('HID-SSI-SDK:: Error: keyAgreement is not allowed in verificationRelationships');\n        }\n        verificationRelationships = this._filterVerificationRelationships(params.verificationRelationships);\n      } else {\n        verificationRelationships = this._filterVerificationRelationships([]);\n      }\n      if (!params.publicKeyMultibase) {\n        throw new Error('HID-SSI-SDK:: Error: params.publicKeyMultibase is required to generate new did didoc');\n      }\n      const {\n        publicKeyMultibase: publicKeyMultibase1\n      } = utils_1.default.convertEd25519verificationkey2020toStableLibKeysInto({\n        publicKey: params.publicKeyMultibase\n      });\n      const methodSpecificId = publicKeyMultibase1;\n      let didId;\n      if (params.methodSpecificId) {\n        didId = this._getId(params.methodSpecificId);\n      } else {\n        didId = this._getId(methodSpecificId);\n      }\n      const newDid = new DIDDocument(publicKeyMultibase1, '', didId, IDID_1.IKeyType.Ed25519VerificationKey2020, verificationRelationships);\n      return utils_1.default.jsonToLdConvertor(Object.assign({}, newDid));\n    });\n  }\n  /**\n   * Register a new DID and Document in Hypersign blockchain - an onchain activity\n   * @params\n   *  - params.didDocument          : LD did document\n   *  - params.privateKeyMultibase  : Private Key to sign the doc\n   *  - params.verificationMethodId : VerificationMethodId of the document\n   * @returns {Promise<object>} Result of the registration\n   */\n  register(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      // TODO:  this method MUST also accept signature/proof\n      if (!params.didDocument || Object.keys(params.didDocument).length === 0) {\n        throw new Error('HID-SSI-SDK:: Error: params.didDocString is required to register a did');\n      }\n      if (!this.didrpc) {\n        throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n      }\n      const {\n        didDocument\n      } = params;\n      const didDocStringJson = utils_1.default.ldToJsonConvertor(didDocument);\n      const didDoc = didDocStringJson;\n      const signInfos = [];\n      if (!params.signData) {\n        if (!params.privateKeyMultibase) {\n          throw new Error('HID-SSI-SDK:: Error: params.privateKeyMultibase is required to register a did');\n        }\n        if (!params.verificationMethodId) {\n          throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to register a did');\n        }\n        const {\n          privateKeyMultibase,\n          verificationMethodId\n        } = params;\n        const signature = yield this._sign({\n          didDocString: JSON.stringify(didDocStringJson),\n          privateKeyMultibase\n        });\n        signInfos.push({\n          signature,\n          verification_method_id: verificationMethodId,\n          clientSpec: undefined\n        });\n      } else {\n        if (params.signData.length < 1) {\n          throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n        }\n        for (const i in params.signData) {\n          if (!params.signData[i].verificationMethodId) {\n            throw new Error(`HID-SSI-SDK:: Error: params.signData[${i}].verificationMethodId is required to register a did`);\n          }\n          if (!params.signData[i].privateKeyMultibase) {\n            throw new Error(`HID-SSI-SDK:: Error: params.signData[${i}].privateKeyMultibase is required to register a did`);\n          }\n          if (!params.signData[i].type) {\n            throw new Error(`HID-SSI-SDK:: Error: params.signData[${i}].type is required to register a did`);\n          }\n          const {\n            type,\n            privateKeyMultibase,\n            verificationMethodId\n          } = params.signData[i];\n          if (type !== IDID_1.IKeyType.X25519KeyAgreementKey2020 && type !== IDID_1.IKeyType.X25519KeyAgreementKeyEIP5630) {\n            const signature = yield this._sign({\n              didDocString: JSON.stringify(didDocStringJson),\n              privateKeyMultibase\n            });\n            signInfos.push({\n              signature,\n              verification_method_id: verificationMethodId,\n              clientSpec: undefined\n            });\n          }\n        }\n      }\n      return yield this.didrpc.registerDID(didDoc, signInfos);\n    });\n  }\n  /**\n   * Resolves a DID into DIDDocument from Hypersign blockchain - an onchain activity\n   * @params\n   *  - params.did                        : DID\n   *  - params.ed25519verificationkey2020 : *Optional* True/False\n   * @returns  {Promise<IDIDResolve>} didDocument and didDocumentMetadata\n   */\n  resolve(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!params.did) {\n        throw new Error('HID-SSI-SDK:: Error: params.did is required to resolve a did');\n      }\n      if (!this.didrpc) {\n        throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n      }\n      const result = yield this.didrpc.resolveDID(params.did);\n      if (params.ed25519verificationkey2020) {\n        const didDoc = result.didDocument;\n        const verificationMethods = didDoc.verificationMethod;\n        verificationMethods.forEach(verificationMethod => {\n          if (verificationMethod.type === constant.DID.VERIFICATION_METHOD_TYPE) {\n            const ed25519PublicKey = utils_1.default.convertedStableLibKeysIntoEd25519verificationkey2020({\n              publicKey: verificationMethod.publicKeyMultibase\n            });\n            verificationMethod.publicKeyMultibase = ed25519PublicKey.publicKeyMultibase;\n          }\n        });\n        didDoc.verificationMethod = verificationMethods;\n      }\n      return {\n        didDocument: utils_1.default.jsonToLdConvertor(result.didDocument),\n        didDocumentMetadata: result.didDocumentMetadata\n      };\n    });\n  }\n  /**\n   * Update a DIDDocument in Hypersign blockchain - an onchain activity\n   * @params\n   *  - params.didDocument          : LD did document\n   *  - params.privateKeyMultibase  : Private Key to sign the doc\n   *  - params.verificationMethodId : VerificationMethodId of the document\n   *  - params.versionId            : Version of the document\n   * @returns {Promise<object>} Result of the update operation\n   */\n  update(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!params.didDocument) {\n        throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to update a did');\n      }\n      if (!params.privateKeyMultibase) {\n        throw new Error('HID-SSI-SDK:: Error: params.privateKeyMultibase is required to update a did');\n      }\n      if (!params.verificationMethodId) {\n        throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to update a did');\n      }\n      if (!params.versionId) {\n        throw new Error('HID-SSI-SDK:: Error: params.versionId is required to update a did');\n      }\n      if (!this.didrpc) {\n        throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n      }\n      const {\n        didDocument,\n        privateKeyMultibase,\n        verificationMethodId,\n        versionId\n      } = params;\n      const didDocStringJson = utils_1.default.ldToJsonConvertor(didDocument);\n      const signature = yield this._sign({\n        didDocString: JSON.stringify(didDocStringJson),\n        privateKeyMultibase\n      });\n      const didDoc = didDocStringJson;\n      const signInfos = [{\n        signature,\n        verification_method_id: verificationMethodId,\n        clientSpec: undefined\n      }];\n      return yield this.didrpc.updateDID(didDoc, signInfos, versionId);\n    });\n  }\n  /**\n   * Deactivate a DIDDocument in Hypersign blockchain - an onchain activity\n   * @params\n   *  - params.didDocument          : LD did document\n   *  - params.privateKeyMultibase  : Private Key to sign the doc\n   *  - params.verificationMethodId : VerificationMethodId of the document\n   *  - params.versionId            : Version of the document\n   * @returns {Promise<object>} Result of the deactivatee operation\n   */\n  deactivate(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!params.didDocument) {\n        throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to deactivate a did');\n      }\n      if (!params.privateKeyMultibase) {\n        throw new Error('HID-SSI-SDK:: Error: params.privateKeyMultibase is required to deactivate a did');\n      }\n      if (!params.verificationMethodId) {\n        throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to deactivate a did');\n      }\n      if (!params.versionId) {\n        throw new Error('HID-SSI-SDK:: Error: params.versionId is required to deactivate a did');\n      }\n      if (!this.didrpc) {\n        throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n      }\n      const {\n        didDocument,\n        privateKeyMultibase,\n        verificationMethodId,\n        versionId\n      } = params;\n      const didDocStringJson = utils_1.default.ldToJsonConvertor(didDocument);\n      const signature = yield this._sign({\n        didDocString: JSON.stringify(didDocStringJson),\n        privateKeyMultibase\n      });\n      const didDoc = didDocStringJson;\n      const signInfos = [{\n        signature,\n        verification_method_id: verificationMethodId,\n        clientSpec: undefined\n      }];\n      return yield this.didrpc.deactivateDID(didDoc.id, signInfos, versionId);\n    });\n  }\n  /**\n   * Signs a DIDDocument\n   * @params\n   *  - params.didDocument               :\n   *  - params.privateKeyMultibase       :   private key in multibase format (base58 digitalbazar format)\n   *  - params.challenge                 :   challenge is a random string generated by the client\n   *  - params.did                       :   did of the user\n   *  - params.domain                    :   domain is the domain of the DID Document that is being authenticated\n   *  - params.verificationMethodId      :   verificationMethodId of the DID\n   * @returns {Promise<object>} Signed DID Document\n   */\n  sign(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const {\n        privateKeyMultibase,\n        challenge,\n        domain,\n        did,\n        didDocument,\n        verificationMethodId\n      } = params;\n      let resolveddoc;\n      if (!privateKeyMultibase) {\n        throw new Error('HID-SSI-SDK:: Error: params.privateKey is required to sign a did');\n      }\n      if (!challenge) {\n        throw new Error('HID-SSI-SDK:: Error: params.challenge is required to sign a did');\n      }\n      if (!domain) {\n        throw new Error('HID-SSI-SDK:: Error: params.domain is required to sign a did');\n      }\n      try {\n        // if did is prvovided then resolve the did doc from the blockchain or else use the did doc provided in the params object to sign the did doc with the proof\n        if (did && this.didrpc) {\n          resolveddoc = yield this.didrpc.resolveDID(did);\n        } else if (didDocument) {\n          resolveddoc = {};\n          resolveddoc.didDocument = didDocument;\n        } else {\n          throw new Error('HID-SSI-SDK:: Error: params.did or params.didDocument is required to sign a did');\n        }\n      } catch (error) {\n        throw new Error(`HID-SSI-SDK:: Error: could not resolve did ${did}`);\n      }\n      const publicKeyId = verificationMethodId;\n      const pubkey = resolveddoc.didDocument.verificationMethod.find(item => item.id === publicKeyId);\n      if (!pubkey) {\n        throw new Error('HID-SSI-SDK:: Error: Incorrect verification method id');\n      }\n      const {\n        publicKeyMultibase: publicKeyMultibase1\n      } = utils_1.default.convertedStableLibKeysIntoEd25519verificationkey2020({\n        publicKey: pubkey.publicKeyMultibase\n      });\n      const keyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.from({\n        id: publicKeyId,\n        privateKeyMultibase,\n        publicKeyMultibase: publicKeyMultibase1\n      });\n      const suite = new ed25519_signature_2020_1.Ed25519Signature2020({\n        verificationMethod: publicKeyId,\n        key: keyPair\n      });\n      const didDocumentLd = utils_1.default.jsonToLdConvertor(resolveddoc.didDocument);\n      didDocumentLd['@context'].push(constant.VC.CREDENTAIL_SECURITY_SUITE);\n      // didDocumentLd['@context'].push(constant.VC.CREDENTAIL_ECDSA_SECURITY_SUITE)\n      const signedDidDocument = yield jsonld_signatures_1.default.sign(didDocumentLd, {\n        suite,\n        purpose: new AuthenticationProofPurpose({\n          challenge,\n          domain\n        }),\n        documentLoader: v1_1.default,\n        compactProof: constant.compactProof\n      });\n      return signedDidDocument;\n    });\n  }\n  /**\n   * Verifies a signed DIDDocument\n   * @params\n   *  - params.didDocument :   Signed DID Document\n   *  - params.privateKey  :   private key in multibase format (base58 digitalbazar format)\n   *  - params.challenge   :   challenge is a random string generated by the client\n   *  - params.did         :   did of the user\n   *  - params.domain      :   domain is the domain of the DID Document that is being authenticated\n   * @returns Promise<{ verificationResult }> Verification Result\n   */\n  verify(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const {\n        didDocument,\n        verificationMethodId,\n        challenge,\n        domain\n      } = params;\n      if (!didDocument) {\n        throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to verify a did');\n      }\n      if (!didDocument['proof']) {\n        throw new Error('HID-SSI-SDK:: Error: params.didDocument.proof is not present in the signed did document');\n      }\n      if (!verificationMethodId) {\n        throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to verify a did');\n      }\n      if (!challenge) {\n        throw new Error('HID-SSI-SDK:: Error: params.challenge is required to verify a did');\n      }\n      const didDoc = didDocument;\n      const publicKeyId = verificationMethodId;\n      const pubkey = didDoc.verificationMethod.find(item => item.id === publicKeyId);\n      if (!pubkey) {\n        throw new Error('HID-SSI-SDK:: Error: could not find verification method for verificationMethodId: ' + verificationMethodId + ' in did document');\n      }\n      const {\n        publicKeyMultibase: publicKeyMultibase1\n      } = utils_1.default.convertedStableLibKeysIntoEd25519verificationkey2020({\n        publicKey: pubkey.publicKeyMultibase\n      });\n      const keyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.from({\n        id: publicKeyId,\n        publicKeyMultibase: publicKeyMultibase1\n      });\n      const suite = new ed25519_signature_2020_1.Ed25519Signature2020({\n        key: keyPair\n      });\n      suite.date = new Date(new Date().getTime() - 100000).toISOString();\n      const controller = {\n        '@context': constant.DID.CONTROLLER_CONTEXT,\n        id: publicKeyId,\n        authentication: didDoc.authentication\n      };\n      const purpose = new AuthenticationProofPurpose({\n        controller,\n        challenge,\n        domain\n      });\n      const result = yield jsonld_signatures_1.default.verify(didDoc, {\n        suite,\n        purpose: purpose,\n        documentLoader: v1_1.default,\n        compactProof: constant.compactProof\n      });\n      return result;\n    });\n  }\n  // using in API\n  createByClientSpec(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this['window'] === 'undefined') {\n        console.log('HID-SSI-SDK:: Warning:  Running in non browser mode');\n      }\n      if (!params.methodSpecificId) {\n        throw new Error('HID-SSI-SDK:: Error: params.methodSpecificId is required to create didoc');\n      }\n      if (!params.chainId) {\n        throw new Error('HID-SSI-SDK:: Error: params.chainId is required to create didoc');\n      }\n      if (!params.address) {\n        throw new Error('HID-SSI-SDK:: Error: params.address is required to create didoc');\n      }\n      if (!params.clientSpec) {\n        throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is required to create didoc');\n      }\n      if (!(params.clientSpec in IDID_1.IClientSpec)) {\n        throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is invalid');\n      }\n      let didDoc;\n      let verificationRelationships = [];\n      if (params.verificationRelationships && params.verificationRelationships.length > 0) {\n        if (params.verificationRelationships.includes(IDID_1.IVerificationRelationships.keyAgreement)) {\n          throw new Error('HID-SSI-SDK:: Error: keyAgreement is not allowed in verificationRelationships');\n        }\n        verificationRelationships = this._filterVerificationRelationships(params.verificationRelationships);\n      } else {\n        verificationRelationships = this._filterVerificationRelationships([]);\n      }\n      switch (params.clientSpec) {\n        case IDID_1.IClientSpec['eth-personalSign']:\n          {\n            const blockChainAccountId = this._getBlockChainAccountID(params.chainId, params.address);\n            const didId = this._getId(params.methodSpecificId);\n            const newDid = new DIDDocument('', blockChainAccountId, didId, IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020, verificationRelationships);\n            didDoc = utils_1.default.jsonToLdConvertor(Object.assign({}, newDid));\n            delete didDoc.service;\n            break;\n          }\n        case IDID_1.IClientSpec['cosmos-ADR036']:\n          {\n            if (!params.publicKey) {\n              throw new Error('HID-SSI-SDK:: Error: params.publicKey is required to create didoc for ' + IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019);\n            }\n            if (!this._isValidMultibaseBase58String(params.publicKey)) {\n              throw new Error('HID-SSI-SDK:: Error: params.publicKey mustbe multibase encoded base58 string for ' + IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019);\n            }\n            const multibasePublicKey = params.publicKey;\n            const didId = this._getId(params.methodSpecificId);\n            const blockChainAccountId = 'cosmos:' + params.chainId + ':' + params.address;\n            const newDid = new DIDDocument(multibasePublicKey, blockChainAccountId, didId, IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019);\n            didDoc = utils_1.default.jsonToLdConvertor(Object.assign({}, newDid));\n            break;\n          }\n        default:\n          {\n            throw new Error('HID-SSI-SDK:: Error: params.clientSpec is invalid use object.generate() method');\n          }\n      }\n      return didDoc;\n    });\n  }\n  // using in API\n  registerByClientSpec(params) {\n    var _a, _b, _c, _d;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!params.didDocument || Object.keys(params.didDocument).length === 0) {\n        throw new Error('HID-SSI-SDK:: Error: params.didDocString is required to register a did');\n      }\n      if (!this.didrpc) {\n        throw new Error('HID-SSI-SDK:: Error:  HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n      }\n      if (!params.signInfos) {\n        throw new Error('HID-SSI-SDK:: Error: params.signInfos is required to register a did');\n      }\n      if (params.signInfos.length < 1) {\n        throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n      }\n      if (!params.signInfos) {\n        throw new Error('HID-SSI-SDK:: Error: params.signInfos is required to register a did');\n      }\n      if (params.signInfos.length < 1) {\n        throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n      }\n      for (const i in params.signInfos) {\n        if (!params.signInfos[i].verification_method_id) {\n          throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].verification_method_id is required to register a did`);\n        }\n        if (!params.signInfos[i].clientSpec) {\n          throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].clientSpec is required to register a did`);\n        }\n        if (((_a = params.signInfos[i].clientSpec) === null || _a === void 0 ? void 0 : _a.type) === IDID_1.IClientSpec['cosmos-ADR036']) {\n          if (((_b = params.signInfos[i].clientSpec) === null || _b === void 0 ? void 0 : _b.adr036SignerAddress) === '' || ((_c = params.signInfos[i].clientSpec) === null || _c === void 0 ? void 0 : _c.adr036SignerAddress) === undefined) {\n            throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].adr036SignerAddress is required to register a did, when clientSpec type is${(_d = params.signInfos[i].clientSpec) === null || _d === void 0 ? void 0 : _d.type} `);\n          }\n        }\n        if (!params.signInfos[i].signature) {\n          throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].signature is required to register a did`);\n        }\n      }\n      const didDocStringJson = utils_1.default.ldToJsonConvertor(params.didDocument);\n      const didDoc = didDocStringJson;\n      return yield this.didrpc.registerDID(didDoc, params.signInfos);\n    });\n  }\n  // using in API\n  updateByClientSpec(params) {\n    var _a, _b, _c, _d;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.didrpc) {\n        throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n      }\n      if (!params.didDocument) {\n        throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to update a did');\n      }\n      if (!params.signInfos) {\n        throw new Error('HID-SSI-SDK:: Error: params.signInfos is required to register a did');\n      }\n      if (params.signInfos.length < 1) {\n        throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n      }\n      for (const i in params.signInfos) {\n        if (!params.signInfos[i].verification_method_id) {\n          throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].verification_method_id is required to register a did`);\n        }\n        if (!params.signInfos[i].clientSpec) {\n          throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].clientSpec is required to register a did`);\n        }\n        if (((_a = params.signInfos[i].clientSpec) === null || _a === void 0 ? void 0 : _a.type) === IDID_1.IClientSpec['cosmos-ADR036']) {\n          if (((_b = params.signInfos[i].clientSpec) === null || _b === void 0 ? void 0 : _b.adr036SignerAddress) === '' || ((_c = params.signInfos[i].clientSpec) === null || _c === void 0 ? void 0 : _c.adr036SignerAddress) === undefined) {\n            throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].adr036SignerAddress is required to register a did, when clientSpec type is${(_d = params.signInfos[i].clientSpec) === null || _d === void 0 ? void 0 : _d.type} `);\n          }\n        }\n        if (!params.signInfos[i].signature) {\n          throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].signature is required to register a did`);\n        }\n      }\n      if (!params.versionId) {\n        throw new Error('HID-SSI-SDK:: Error: params.versionId is required to update a did');\n      }\n      const {\n        didDocument,\n        signInfos,\n        versionId\n      } = params;\n      return yield this.didrpc.updateDID(didDocument, signInfos, versionId);\n    });\n  }\n  // using in API\n  deactivateByClientSpec(params) {\n    var _a, _b, _c, _d;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.didrpc) {\n        throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n      }\n      if (!params.didDocument) {\n        throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to deactivate a did');\n      }\n      if (!params.signInfos) {\n        throw new Error('HID-SSI-SDK:: Error: params.signInfos is required to register a did');\n      }\n      if (params.signInfos.length < 1) {\n        throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n      }\n      for (const i in params.signInfos) {\n        if (!params.signInfos[i].verification_method_id) {\n          throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].verification_method_id is required to register a did`);\n        }\n        if (!params.signInfos[i].clientSpec) {\n          throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].clientSpec is required to register a did`);\n        }\n        if (((_a = params.signInfos[i].clientSpec) === null || _a === void 0 ? void 0 : _a.type) === IDID_1.IClientSpec['cosmos-ADR036']) {\n          if (((_b = params.signInfos[i].clientSpec) === null || _b === void 0 ? void 0 : _b.adr036SignerAddress) === '' || ((_c = params.signInfos[i].clientSpec) === null || _c === void 0 ? void 0 : _c.adr036SignerAddress) === undefined) {\n            throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].adr036SignerAddress is required to register a did, when clientSpec type is${(_d = params.signInfos[i].clientSpec) === null || _d === void 0 ? void 0 : _d.type} `);\n          }\n        }\n        if (!params.signInfos[i].signature) {\n          throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].signature is required to register a did`);\n        }\n      }\n      if (!params.versionId) {\n        throw new Error('HID-SSI-SDK:: Error: params.versionId is required to deactivate a did');\n      }\n      // if (!params.clientSpec) {\n      //   throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is required to deactivate');\n      // }\n      // if (!(params.clientSpec in IClientSpec)) {\n      //   throw new Error('HID-SSI-SDK:: Error: invalid clientSpec');\n      // }\n      const {\n        didDocument,\n        signInfos,\n        versionId\n      } = params;\n      const didDoc = didDocument;\n      return yield this.didrpc.deactivateDID(didDoc.id, signInfos, versionId);\n    });\n  }\n  signAndRegisterByClientSpec(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!params.didDocument || Object.keys(params.didDocument).length === 0) {\n        throw new Error('HID-SSI-SDK:: Error: params.didDocString is required to register a did');\n      }\n      if (!params.clientSpec) {\n        throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is required to sign');\n      }\n      if (!(params.clientSpec in IDID_1.IClientSpec)) {\n        throw new Error('HID-SSI-SDK:: Error: invalid clientSpec');\n      }\n      if (!this.didrpc) {\n        throw new Error('HID-SSI-SDK:: Error:  HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n      }\n      if (!params.verificationMethodId) {\n        throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to register a did');\n      }\n      if (!params.web3) {\n        throw new Error('HID-SSI-SDK:: Error: params.web should be passed');\n      }\n      if (!params.address) {\n        throw new Error('HID-SSI-SDK:: Error: params.address is required to sign a did');\n      }\n      const {\n        didDocument,\n        signature\n      } = yield this.signByClientSpec({\n        didDocument: params.didDocument,\n        clientSpec: params.clientSpec,\n        address: params.address,\n        web3: params.web3,\n        chainId: params.chainId\n      });\n      const signInfos = [{\n        signature,\n        verification_method_id: params.verificationMethodId,\n        clientSpec: {\n          type: params.clientSpec,\n          adr036SignerAddress: params.clientSpec === IDID_1.IClientSpec['cosmos-ADR036'] ? params.address : ''\n        }\n      }];\n      return yield this.registerByClientSpec({\n        didDocument,\n        signInfos\n        // only for [cosmos-ADR036]\n      });\n    });\n  }\n\n  signByClientSpec(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this['window'] === 'undefined') {\n        throw new Error('HID-SSI-SDK:: Error:  Running in non browser mode');\n      }\n      if (!params.didDocument) {\n        throw Error('HID-SSI-SDK:: Error: params.didDocument is required to sign');\n      }\n      if (!params.address) {\n        throw new Error('HID-SSI-SDK:: Error: params.address is required to sign a did');\n      }\n      if (!params.clientSpec) {\n        throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is required to sign');\n      }\n      if (!(params.clientSpec in IDID_1.IClientSpec)) {\n        throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is invalid');\n      }\n      switch (params.clientSpec) {\n        case IDID_1.IClientSpec['eth-personalSign']:\n          {\n            const didDocStringJson = utils_1.default.ldToJsonConvertor(params.didDocument);\n            const didDoc = didDocStringJson;\n            const signature = yield params.web3.eth.personal.sign(JSON.stringify(didDoc, (key, value) => {\n              if (value === '' || Array.isArray(value) && value.length === 0) {\n                return undefined;\n              }\n              return value;\n            }), params.address);\n            return {\n              didDocument: didDoc,\n              signature\n            };\n          }\n        case IDID_1.IClientSpec['cosmos-ADR036']:\n          {\n            if (!params.chainId) {\n              throw new Error('HID-SSI-SDK:: Error:  params.chainId is required to sign for clientSpec ' + IDID_1.IClientSpec['cosmos-ADR036'] + ' and keyType ' + IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019);\n            }\n            const didDocStringJson = utils_1.default.ldToJsonConvertor(params.didDocument);\n            const didDoc = didDocStringJson;\n            const didDocBytes = (yield did_1.Did.encode(didDoc)).finish();\n            const signRespObj = yield params.web3.requestMethod('signArbitrary', [params.chainId, params.address, didDocBytes]);\n            return {\n              didDocument: didDoc,\n              signature: signRespObj['signature']\n            };\n          }\n        default:\n          throw Error('HID-SSI-SDK:: Error: Invalid clientSpec');\n          break;\n      }\n    });\n  }\n  /**\n   * Add verification method\n   * @param\n   * - params.didDocument          : Optional, unregistered Did document\n   * - params.did                  : Optional, didDoc Id of registered didDoc\n   * - params.type                 : key type\n   * - params.id                   : Optional, verificationMethodId\n   * - params.controller           : Optional, controller field\n   * - params.publicKeyMultibase   : public key\n   * - params.blockchainAccountId  : Optional, blockchain accountId\n   * @return {Promise<Did>}  DidDocument object\n   */\n  addVerificationMethod(params) {\n    var _a, _b, _c;\n    return __awaiter(this, void 0, void 0, function* () {\n      let resolvedDidDoc;\n      if (!params.did && (!params.didDocument || Object.keys(params.didDocument).length === 0)) {\n        throw new Error('HID-SSI_SDK:: Error: params.did or params.didDocument is required to addVerificationMethod');\n      }\n      if (!params.type) {\n        throw new Error('HID-SSI-SDK:: Error: params.type is required to addVerificationMethod');\n      }\n      const {\n        type\n      } = params;\n      if (!(type in IDID_1.IKeyType)) {\n        throw new Error('HID-SSI-SDK:: Error: params.type is invalid');\n      }\n      try {\n        if (params.did) {\n          if (!this.didrpc) {\n            throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n          }\n          resolvedDidDoc = yield this.didrpc.resolveDID(params.did);\n          if (!resolvedDidDoc.didDocument) {\n            if (!params.didDocument) {\n              throw new Error('HID-SSI_SDK:: Error: can not able to resolve did please send didDocument');\n            }\n          }\n        } else if (params.didDocument) {\n          resolvedDidDoc = {};\n          resolvedDidDoc.didDocument = params.didDocument;\n        } else {\n          throw new Error('HID-SSI-SDK:: Error: params.did or params.didDocument is required to addVerificationMethod');\n        }\n      } catch (e) {\n        throw new Error(`HID-SSI-SDK:: Error: could not resolve did ${params.did}`);\n      }\n      if (type === IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020 && (!params.blockchainAccountId || params.blockchainAccountId.trim() === '')) {\n        throw new Error(`HID-SSI-SDK:: Error: params.blockchainAccountId is required for keyType ${params.type}`);\n      }\n      if (type === IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020 && (!params.id || params.id.trim() === '')) {\n        throw new Error(`HID-SSI-SDK:: Error: params.id is required for keyType ${params.type}`);\n      }\n      if (type === IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019 && (!params.blockchainAccountId || params.blockchainAccountId.trim() === '' || !params.publicKeyMultibase || params.publicKeyMultibase.trim() === '')) {\n        throw new Error(`HID-SSI-SDK:: Error: params.blockchainAccountId and params.publicKeyMultibase is required for keyType ${params.type}`);\n      }\n      if ((type === IDID_1.IKeyType.Ed25519VerificationKey2020 || type === IDID_1.IKeyType.X25519KeyAgreementKey2020 || type === IDID_1.IKeyType.X25519KeyAgreementKeyEIP5630) && !params.publicKeyMultibase) {\n        throw new Error('HID-SSI-SDK:: Error: params.publicKeyMultibase is required to addVerificationMethod');\n      }\n      const verificationMethod = {};\n      const {\n        didDocument\n      } = resolvedDidDoc;\n      if (params.id) {\n        const checkIfVmIdExists = didDocument.verificationMethod.some(vm => vm.id === params.id);\n        if (checkIfVmIdExists) {\n          throw new Error(`HID-SSI-SDK:: Error: verificationMethod ${params.id} already exists`);\n        }\n      }\n      const VMLength = didDocument.verificationMethod.length;\n      verificationMethod['id'] = (_a = params === null || params === void 0 ? void 0 : params.id) !== null && _a !== void 0 ? _a : `${didDocument.id}#key-${VMLength + 1}`;\n      verificationMethod['type'] = type;\n      verificationMethod['controller'] = didDocument.id;\n      if (type !== IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020) {\n        if (type === IDID_1.IKeyType.Ed25519VerificationKey2020) {\n          const {\n            publicKeyMultibase: publicKeyMultibase1\n          } = utils_1.default.convertEd25519verificationkey2020toStableLibKeysInto({\n            publicKey: params.publicKeyMultibase\n          });\n          verificationMethod['publicKeyMultibase'] = publicKeyMultibase1;\n        } else {\n          verificationMethod['publicKeyMultibase'] = (_b = params === null || params === void 0 ? void 0 : params.publicKeyMultibase) !== null && _b !== void 0 ? _b : '';\n        }\n      }\n      verificationMethod['blockchainAccountId'] = (_c = params === null || params === void 0 ? void 0 : params.blockchainAccountId) !== null && _c !== void 0 ? _c : '';\n      didDocument.verificationMethod.push(verificationMethod);\n      if (verificationMethod['type'] === IDID_1.IKeyType.X25519KeyAgreementKey2020 || verificationMethod['type'] === IDID_1.IKeyType.X25519KeyAgreementKeyEIP5630) {\n        didDocument.keyAgreement.push(verificationMethod['id']);\n      } else {\n        didDocument.authentication.push(verificationMethod['id']);\n        didDocument.assertionMethod.push(verificationMethod['id']);\n        didDocument.capabilityDelegation.push(verificationMethod['id']);\n        didDocument.capabilityInvocation.push(verificationMethod['id']);\n      }\n      if (verificationMethod['type'] === IDID_1.IKeyType.X25519KeyAgreementKey2020) {\n        didDocument['@context'].push(constant['DID_' + IDID_1.IKeyType.Ed25519VerificationKey2020].DID_KEYAGREEMENT_CONTEXT);\n      }\n      if (verificationMethod['type'] === IDID_1.IKeyType.X25519KeyAgreementKeyEIP5630) {\n        didDocument['@context'].push(constant['DID_' + IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020].DID_KEYAGREEMENT_CONTEXT);\n      }\n      return didDocument;\n    });\n  }\n}\nexports.default = HypersignDID;","map":{"version":3,"names":["require","__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","done","then","apply","__importDefault","exports","constant","jsonld_signatures_1","AuthenticationProofPurpose","default","purposes","didRPC_1","utils_1","ed25519","did_1","ed25519_verification_key_2020_1","ed25519_signature_2020_1","web3_1","IDID_1","v1_1","DIDDocument","constructor","publicKey","blockchainAccountId","id","keyType","verificationRelationships","vm","IKeyType","Ed25519VerificationKey2020","context","DID_BASE_CONTEXT","controller","alsoKnownAs","type","VERIFICATION_METHOD_TYPE","publicKeyMultibase","verificationMethod","authentication","assertionMethod","keyAgreement","capabilityInvocation","capabilityDelegation","forEach","service","EcdsaSecp256k1RecoveryMethod2020","EcdsaSecp256k1VerificationKey2019","Error","HypersignDID","params","_getId","methodSpecificId","length","did","namespace","DID","SCHEME","METHOD","_isValidMultibaseBase58String","str","multibaseBase58Regex","test","offlineSigner","nodeRpcEndpoint","nodeRestEndpoint","nodeRPCEp","nodeRestEp","rpcConstructorParams","didrpc","DIDRpc","_sign","privateKeyMultibase","privateKeyMultibaseConverted","convertEd25519verificationkey2020toStableLibKeysInto","privKey","didDocString","JSON","parse","didBytes","Did","encode","finish","signed","sign","Buffer","from","toString","signDid","didDoc","ldToJsonConvertor","didDocument","stringify","_filterVerificationRelationships","vR","IVerificationRelationships","set1","Set","set2","Array","filter","has","_getBlockChainAccountID","chainId","address","web3","inDecimelChainId","utils","hexToNumber","blockChainAccountId","CAIP_10_PREFIX","eip155","error","init","generateKeys","edKeyPair","seed","seedBytes","Uint8Array","generate","exportedKp","export","privateKey","assign","includes","publicKeyMultibase1","didId","newDid","jsonToLdConvertor","register","keys","didDocStringJson","signInfos","signData","verificationMethodId","signature","push","verification_method_id","clientSpec","i","X25519KeyAgreementKey2020","X25519KeyAgreementKeyEIP5630","registerDID","resolveDID","ed25519verificationkey2020","verificationMethods","ed25519PublicKey","convertedStableLibKeysIntoEd25519verificationkey2020","didDocumentMetadata","update","versionId","updateDID","deactivate","deactivateDID","challenge","domain","resolveddoc","publicKeyId","pubkey","find","item","keyPair","suite","Ed25519Signature2020","key","didDocumentLd","VC","CREDENTAIL_SECURITY_SUITE","signedDidDocument","purpose","documentLoader","compactProof","verify","date","Date","getTime","toISOString","CONTROLLER_CONTEXT","createByClientSpec","console","log","IClientSpec","multibasePublicKey","registerByClientSpec","_a","_b","_c","_d","adr036SignerAddress","updateByClientSpec","deactivateByClientSpec","signAndRegisterByClientSpec","signByClientSpec","eth","personal","isArray","didDocBytes","signRespObj","requestMethod","addVerificationMethod","resolvedDidDoc","trim","checkIfVmIdExists","some","VMLength","DID_KEYAGREEMENT_CONTEXT"],"sources":["/home/pratap/hid-ssi-js-sdk/build/src/did/did.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Copyright (c) 2023, Hypermine Pvt. Ltd.\n * All rights reserved.\n * Author: Hypermine Core Team\n */\nconst constant = __importStar(require(\"../constants\"));\nconst jsonld_signatures_1 = __importDefault(require(\"jsonld-signatures\"));\nconst { AuthenticationProofPurpose } = jsonld_signatures_1.default.purposes;\nconst didRPC_1 = require(\"./didRPC\");\nconst utils_1 = __importDefault(require(\"../utils\"));\nconst ed25519 = require('@stablelib/ed25519');\nconst did_1 = require(\"../../libs/generated/ssi/did\");\nconst ed25519_verification_key_2020_1 = require(\"@digitalbazaar/ed25519-verification-key-2020\");\nconst ed25519_signature_2020_1 = require(\"@digitalbazaar/ed25519-signature-2020\");\nconst web3_1 = __importDefault(require(\"web3\"));\nconst IDID_1 = require(\"./IDID\");\nconst v1_1 = __importDefault(require(\"../../libs/w3cache/v1\"));\nclass DIDDocument {\n    constructor(publicKey, blockchainAccountId, id, keyType, verificationRelationships) {\n        let vm;\n        switch (keyType) {\n            case IDID_1.IKeyType.Ed25519VerificationKey2020: {\n                this.context = [constant['DID_' + keyType].DID_BASE_CONTEXT];\n                this.id = id;\n                this.controller = [this.id];\n                this.alsoKnownAs = [this.id];\n                vm = {\n                    id: this.id + '#key-1',\n                    type: constant['DID_' + keyType].VERIFICATION_METHOD_TYPE,\n                    controller: this.id,\n                    publicKeyMultibase: publicKey,\n                    blockchainAccountId: '',\n                };\n                const verificationMethod = vm;\n                this.verificationMethod = [verificationMethod];\n                this.authentication = [];\n                this.assertionMethod = [];\n                this.keyAgreement = [];\n                this.capabilityInvocation = [];\n                this.capabilityDelegation = [];\n                verificationRelationships === null || verificationRelationships === void 0 ? void 0 : verificationRelationships.forEach((value) => {\n                    this[value] = [verificationMethod.id];\n                });\n                // TODO: we should take services object in consntructor\n                this.service = [];\n                break;\n            }\n            case IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020: {\n                this.context = [constant['DID_' + keyType].DID_BASE_CONTEXT];\n                this.id = id;\n                this.controller = [this.id];\n                this.alsoKnownAs = [this.id];\n                vm = {\n                    id: this.id + '#key-1',\n                    type: constant['DID_' + keyType].VERIFICATION_METHOD_TYPE,\n                    controller: this.id,\n                    blockchainAccountId: blockchainAccountId,\n                };\n                const verificationMethod = vm;\n                this.verificationMethod = [verificationMethod];\n                this.authentication = [];\n                this.assertionMethod = [];\n                this.keyAgreement = [];\n                this.capabilityInvocation = [];\n                this.capabilityDelegation = [];\n                verificationRelationships === null || verificationRelationships === void 0 ? void 0 : verificationRelationships.forEach((value) => {\n                    this[value] = [verificationMethod.id];\n                });\n                // TODO: we should take services object in consntructor\n                this.service = [];\n                break;\n            }\n            case IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019: {\n                this.context = [constant['DID_' + keyType].DID_BASE_CONTEXT];\n                this.id = id;\n                this.controller = [this.id];\n                this.alsoKnownAs = [];\n                vm = {\n                    id: this.id + '#key-1',\n                    type: constant['DID_' + keyType].VERIFICATION_METHOD_TYPE,\n                    controller: this.id,\n                    publicKeyMultibase: publicKey,\n                    blockchainAccountId: blockchainAccountId,\n                };\n                const verificationMethod = vm;\n                this.verificationMethod = [verificationMethod];\n                this.authentication = [];\n                this.assertionMethod = [];\n                this.keyAgreement = [];\n                this.capabilityInvocation = [];\n                this.capabilityDelegation = [];\n                verificationRelationships === null || verificationRelationships === void 0 ? void 0 : verificationRelationships.forEach((value) => {\n                    this[value] = [verificationMethod.id];\n                });\n                // TODO: we should take services object in consntructor\n                this.service = [];\n                break;\n            }\n            default:\n                throw new Error('Invalid');\n        }\n    }\n}\n/** Class representing HypersignDID */\nclass HypersignDID {\n    /**\n     * Creates instance of HypersignDID class\n     * @constructor\n     * @params\n     *  - params.namespace        : namespace of did id, Default 'did:hid'\n     *  - params.offlineSigner    : signer of type OfflineSigner\n     *  - params.nodeRpcEndpoint  : RPC endpoint of the Hypersign blockchain, Default 'TEST'\n     *  - params.nodeRestEndpoint : REST endpoint of the Hypersign blockchain\n     */\n    constructor(params = {}) {\n        this._getId = (methodSpecificId) => {\n            if (methodSpecificId && methodSpecificId.length < 32) {\n                throw new Error('HID-SSI-SDK:: Error: methodSpecificId should be of minimum size 32');\n            }\n            let did = '';\n            did =\n                this.namespace && this.namespace != ''\n                    ? `${constant.DID.SCHEME}:${constant.DID.METHOD}:${this.namespace}:${methodSpecificId}`\n                    : `${constant.DID.SCHEME}:${constant.DID.METHOD}:${methodSpecificId}`;\n            return did;\n        };\n        this._isValidMultibaseBase58String = (str) => {\n            const multibaseBase58Regex = /^z([1-9A-HJ-NP-Za-km-z]+)$/;\n            return multibaseBase58Regex.test(str);\n        };\n        const { offlineSigner, namespace, nodeRpcEndpoint, nodeRestEndpoint } = params;\n        const nodeRPCEp = nodeRpcEndpoint ? nodeRpcEndpoint : 'MAIN';\n        const nodeRestEp = nodeRestEndpoint ? nodeRestEndpoint : '';\n        const rpcConstructorParams = {\n            offlineSigner,\n            nodeRpcEndpoint: nodeRPCEp,\n            nodeRestEndpoint: nodeRestEp,\n        };\n        this.didrpc = new didRPC_1.DIDRpc(rpcConstructorParams);\n        this.namespace = namespace ? namespace : '';\n    }\n    _sign(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { privateKeyMultibase: privateKeyMultibaseConverted } = utils_1.default.convertEd25519verificationkey2020toStableLibKeysInto({\n                privKey: params.privateKeyMultibase,\n            });\n            const { didDocString } = params;\n            // TODO:  do proper checck of paramaters\n            const did = JSON.parse(didDocString);\n            const didBytes = (yield did_1.Did.encode(did)).finish();\n            const signed = ed25519.sign(privateKeyMultibaseConverted, didBytes);\n            return Buffer.from(signed).toString('base64');\n        });\n    }\n    /**\n     * SignDid method is used to sign the did document\n     * @param params\n     * - params.didDocString: stringified did document\n     * - params.privateKeyMultibase: private key of the did document\n     * @returns string\n     **/\n    signDid(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const didDoc = utils_1.default.ldToJsonConvertor(params.didDocument);\n            const didDocString = JSON.stringify(didDoc);\n            return yield this._sign({\n                didDocString,\n                privateKeyMultibase: params.privateKeyMultibase,\n            });\n        });\n    }\n    _filterVerificationRelationships(verificationRelationships) {\n        let vR = [\n            IDID_1.IVerificationRelationships.assertionMethod,\n            IDID_1.IVerificationRelationships.authentication,\n            IDID_1.IVerificationRelationships.capabilityDelegation,\n            IDID_1.IVerificationRelationships.capabilityInvocation,\n        ];\n        if (verificationRelationships && verificationRelationships.length > 0) {\n            const set1 = new Set(vR);\n            const set2 = new Set(verificationRelationships);\n            vR = Array.from(set1).filter((value) => set2.has(value));\n        }\n        return vR;\n    }\n    /**\n     * Creates a new DID Document from wallet address\n     * @params\n     *  - params.blockChainAccountId  :\n     *  - params.methodSpecificId   : methodSpecificId (min 32 bit alhanumeric) else it will generate new random methodSpecificId or may be walletaddress\n     * @returns {Promise<object>} DidDocument object\n     */\n    _getBlockChainAccountID(chainId, address) {\n        try {\n            const web3 = new web3_1.default();\n            const inDecimelChainId = web3.utils.hexToNumber(chainId);\n            const blockChainAccountId = constant.CAIP_10_PREFIX.eip155 + ':' + inDecimelChainId + ':' + address;\n            return blockChainAccountId;\n        }\n        catch (error) {\n            throw new Error('HID-SSI-SDK:: Error: unsupported chain Id');\n        }\n    }\n    init() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.didrpc) {\n                throw new Error('HID-SSI-SDK:: Error:  HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n            }\n            yield this.didrpc.init();\n        });\n    }\n    /**\n     * Generate a new key pair of type Ed25519VerificationKey2020\n     * @params params.seed - Optional, Seed to generate the key pair, if not passed, random seed will be taken\n     * @params params.controller - Optional, controller field\n     * @returns {Promise<object>} The key pair of type Ed25519\n     */\n    generateKeys(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let edKeyPair;\n            if (params && params.seed && params.controller) {\n                const seedBytes = new Uint8Array(Buffer.from(params.seed));\n                edKeyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.generate({ seed: seedBytes, id: params.controller });\n            }\n            else if (params && params.controller) {\n                edKeyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.generate({ id: params.controller });\n            }\n            else if (params && params.seed) {\n                const seedBytes = new Uint8Array(Buffer.from(params.seed));\n                edKeyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.generate({ seed: seedBytes });\n            }\n            else {\n                edKeyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.generate();\n            }\n            const exportedKp = yield edKeyPair.export({ publicKey: true, privateKey: true });\n            return Object.assign({}, exportedKp);\n        });\n    }\n    /**\n     * Generates a new DID Document\n     * @params\n     *  - params.publicKeyMultibase : public key\n     *  - params.methodSpecificId   : Optional methodSpecificId (min 32 bit alhanumeric) else it will generate new random methodSpecificId\n     *  - params.verificationRelationships: Optional, verification relationships where you want to add your verificaiton method ids\n     * @returns {Promise<object>} DidDocument object\n     */\n    generate(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let verificationRelationships = [];\n            if (params.verificationRelationships && params.verificationRelationships.length > 0) {\n                if (params.verificationRelationships.includes(IDID_1.IVerificationRelationships.keyAgreement)) {\n                    throw new Error('HID-SSI-SDK:: Error: keyAgreement is not allowed in verificationRelationships');\n                }\n                verificationRelationships = this._filterVerificationRelationships(params.verificationRelationships);\n            }\n            else {\n                verificationRelationships = this._filterVerificationRelationships([]);\n            }\n            if (!params.publicKeyMultibase) {\n                throw new Error('HID-SSI-SDK:: Error: params.publicKeyMultibase is required to generate new did didoc');\n            }\n            const { publicKeyMultibase: publicKeyMultibase1 } = utils_1.default.convertEd25519verificationkey2020toStableLibKeysInto({\n                publicKey: params.publicKeyMultibase,\n            });\n            const methodSpecificId = publicKeyMultibase1;\n            let didId;\n            if (params.methodSpecificId) {\n                didId = this._getId(params.methodSpecificId);\n            }\n            else {\n                didId = this._getId(methodSpecificId);\n            }\n            const newDid = new DIDDocument(publicKeyMultibase1, '', didId, IDID_1.IKeyType.Ed25519VerificationKey2020, verificationRelationships);\n            return utils_1.default.jsonToLdConvertor(Object.assign({}, newDid));\n        });\n    }\n    /**\n     * Register a new DID and Document in Hypersign blockchain - an onchain activity\n     * @params\n     *  - params.didDocument          : LD did document\n     *  - params.privateKeyMultibase  : Private Key to sign the doc\n     *  - params.verificationMethodId : VerificationMethodId of the document\n     * @returns {Promise<object>} Result of the registration\n     */\n    register(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            // TODO:  this method MUST also accept signature/proof\n            if (!params.didDocument || Object.keys(params.didDocument).length === 0) {\n                throw new Error('HID-SSI-SDK:: Error: params.didDocString is required to register a did');\n            }\n            if (!this.didrpc) {\n                throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n            }\n            const { didDocument } = params;\n            const didDocStringJson = utils_1.default.ldToJsonConvertor(didDocument);\n            const didDoc = didDocStringJson;\n            const signInfos = [];\n            if (!params.signData) {\n                if (!params.privateKeyMultibase) {\n                    throw new Error('HID-SSI-SDK:: Error: params.privateKeyMultibase is required to register a did');\n                }\n                if (!params.verificationMethodId) {\n                    throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to register a did');\n                }\n                const { privateKeyMultibase, verificationMethodId } = params;\n                const signature = yield this._sign({\n                    didDocString: JSON.stringify(didDocStringJson),\n                    privateKeyMultibase,\n                });\n                signInfos.push({\n                    signature,\n                    verification_method_id: verificationMethodId,\n                    clientSpec: undefined,\n                });\n            }\n            else {\n                if (params.signData.length < 1) {\n                    throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n                }\n                for (const i in params.signData) {\n                    if (!params.signData[i].verificationMethodId) {\n                        throw new Error(`HID-SSI-SDK:: Error: params.signData[${i}].verificationMethodId is required to register a did`);\n                    }\n                    if (!params.signData[i].privateKeyMultibase) {\n                        throw new Error(`HID-SSI-SDK:: Error: params.signData[${i}].privateKeyMultibase is required to register a did`);\n                    }\n                    if (!params.signData[i].type) {\n                        throw new Error(`HID-SSI-SDK:: Error: params.signData[${i}].type is required to register a did`);\n                    }\n                    const { type, privateKeyMultibase, verificationMethodId } = params.signData[i];\n                    if (type !== IDID_1.IKeyType.X25519KeyAgreementKey2020 && type !== IDID_1.IKeyType.X25519KeyAgreementKeyEIP5630) {\n                        const signature = yield this._sign({\n                            didDocString: JSON.stringify(didDocStringJson),\n                            privateKeyMultibase,\n                        });\n                        signInfos.push({\n                            signature,\n                            verification_method_id: verificationMethodId,\n                            clientSpec: undefined,\n                        });\n                    }\n                }\n            }\n            return yield this.didrpc.registerDID(didDoc, signInfos);\n        });\n    }\n    /**\n     * Resolves a DID into DIDDocument from Hypersign blockchain - an onchain activity\n     * @params\n     *  - params.did                        : DID\n     *  - params.ed25519verificationkey2020 : *Optional* True/False\n     * @returns  {Promise<IDIDResolve>} didDocument and didDocumentMetadata\n     */\n    resolve(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!params.did) {\n                throw new Error('HID-SSI-SDK:: Error: params.did is required to resolve a did');\n            }\n            if (!this.didrpc) {\n                throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n            }\n            const result = yield this.didrpc.resolveDID(params.did);\n            if (params.ed25519verificationkey2020) {\n                const didDoc = result.didDocument;\n                const verificationMethods = didDoc.verificationMethod;\n                verificationMethods.forEach((verificationMethod) => {\n                    if (verificationMethod.type === constant.DID.VERIFICATION_METHOD_TYPE) {\n                        const ed25519PublicKey = utils_1.default.convertedStableLibKeysIntoEd25519verificationkey2020({\n                            publicKey: verificationMethod.publicKeyMultibase,\n                        });\n                        verificationMethod.publicKeyMultibase = ed25519PublicKey.publicKeyMultibase;\n                    }\n                });\n                didDoc.verificationMethod = verificationMethods;\n            }\n            return {\n                didDocument: utils_1.default.jsonToLdConvertor(result.didDocument),\n                didDocumentMetadata: result.didDocumentMetadata,\n            };\n        });\n    }\n    /**\n     * Update a DIDDocument in Hypersign blockchain - an onchain activity\n     * @params\n     *  - params.didDocument          : LD did document\n     *  - params.privateKeyMultibase  : Private Key to sign the doc\n     *  - params.verificationMethodId : VerificationMethodId of the document\n     *  - params.versionId            : Version of the document\n     * @returns {Promise<object>} Result of the update operation\n     */\n    update(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!params.didDocument) {\n                throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to update a did');\n            }\n            if (!params.privateKeyMultibase) {\n                throw new Error('HID-SSI-SDK:: Error: params.privateKeyMultibase is required to update a did');\n            }\n            if (!params.verificationMethodId) {\n                throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to update a did');\n            }\n            if (!params.versionId) {\n                throw new Error('HID-SSI-SDK:: Error: params.versionId is required to update a did');\n            }\n            if (!this.didrpc) {\n                throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n            }\n            const { didDocument, privateKeyMultibase, verificationMethodId, versionId } = params;\n            const didDocStringJson = utils_1.default.ldToJsonConvertor(didDocument);\n            const signature = yield this._sign({ didDocString: JSON.stringify(didDocStringJson), privateKeyMultibase });\n            const didDoc = didDocStringJson;\n            const signInfos = [\n                {\n                    signature,\n                    verification_method_id: verificationMethodId,\n                    clientSpec: undefined,\n                },\n            ];\n            return yield this.didrpc.updateDID(didDoc, signInfos, versionId);\n        });\n    }\n    /**\n     * Deactivate a DIDDocument in Hypersign blockchain - an onchain activity\n     * @params\n     *  - params.didDocument          : LD did document\n     *  - params.privateKeyMultibase  : Private Key to sign the doc\n     *  - params.verificationMethodId : VerificationMethodId of the document\n     *  - params.versionId            : Version of the document\n     * @returns {Promise<object>} Result of the deactivatee operation\n     */\n    deactivate(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!params.didDocument) {\n                throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to deactivate a did');\n            }\n            if (!params.privateKeyMultibase) {\n                throw new Error('HID-SSI-SDK:: Error: params.privateKeyMultibase is required to deactivate a did');\n            }\n            if (!params.verificationMethodId) {\n                throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to deactivate a did');\n            }\n            if (!params.versionId) {\n                throw new Error('HID-SSI-SDK:: Error: params.versionId is required to deactivate a did');\n            }\n            if (!this.didrpc) {\n                throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n            }\n            const { didDocument, privateKeyMultibase, verificationMethodId, versionId } = params;\n            const didDocStringJson = utils_1.default.ldToJsonConvertor(didDocument);\n            const signature = yield this._sign({ didDocString: JSON.stringify(didDocStringJson), privateKeyMultibase });\n            const didDoc = didDocStringJson;\n            const signInfos = [\n                {\n                    signature,\n                    verification_method_id: verificationMethodId,\n                    clientSpec: undefined,\n                },\n            ];\n            return yield this.didrpc.deactivateDID(didDoc.id, signInfos, versionId);\n        });\n    }\n    /**\n     * Signs a DIDDocument\n     * @params\n     *  - params.didDocument               :\n     *  - params.privateKeyMultibase       :   private key in multibase format (base58 digitalbazar format)\n     *  - params.challenge                 :   challenge is a random string generated by the client\n     *  - params.did                       :   did of the user\n     *  - params.domain                    :   domain is the domain of the DID Document that is being authenticated\n     *  - params.verificationMethodId      :   verificationMethodId of the DID\n     * @returns {Promise<object>} Signed DID Document\n     */\n    sign(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { privateKeyMultibase, challenge, domain, did, didDocument, verificationMethodId } = params;\n            let resolveddoc;\n            if (!privateKeyMultibase) {\n                throw new Error('HID-SSI-SDK:: Error: params.privateKey is required to sign a did');\n            }\n            if (!challenge) {\n                throw new Error('HID-SSI-SDK:: Error: params.challenge is required to sign a did');\n            }\n            if (!domain) {\n                throw new Error('HID-SSI-SDK:: Error: params.domain is required to sign a did');\n            }\n            try {\n                // if did is prvovided then resolve the did doc from the blockchain or else use the did doc provided in the params object to sign the did doc with the proof\n                if (did && this.didrpc) {\n                    resolveddoc = yield this.didrpc.resolveDID(did);\n                }\n                else if (didDocument) {\n                    resolveddoc = {};\n                    resolveddoc.didDocument = didDocument;\n                }\n                else {\n                    throw new Error('HID-SSI-SDK:: Error: params.did or params.didDocument is required to sign a did');\n                }\n            }\n            catch (error) {\n                throw new Error(`HID-SSI-SDK:: Error: could not resolve did ${did}`);\n            }\n            const publicKeyId = verificationMethodId;\n            const pubkey = resolveddoc.didDocument.verificationMethod.find((item) => item.id === publicKeyId);\n            if (!pubkey) {\n                throw new Error('HID-SSI-SDK:: Error: Incorrect verification method id');\n            }\n            const { publicKeyMultibase: publicKeyMultibase1 } = utils_1.default.convertedStableLibKeysIntoEd25519verificationkey2020({\n                publicKey: pubkey.publicKeyMultibase,\n            });\n            const keyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.from({\n                id: publicKeyId,\n                privateKeyMultibase,\n                publicKeyMultibase: publicKeyMultibase1,\n            });\n            const suite = new ed25519_signature_2020_1.Ed25519Signature2020({\n                verificationMethod: publicKeyId,\n                key: keyPair,\n            });\n            const didDocumentLd = utils_1.default.jsonToLdConvertor(resolveddoc.didDocument);\n            didDocumentLd['@context'].push(constant.VC.CREDENTAIL_SECURITY_SUITE);\n            // didDocumentLd['@context'].push(constant.VC.CREDENTAIL_ECDSA_SECURITY_SUITE)\n            const signedDidDocument = (yield jsonld_signatures_1.default.sign(didDocumentLd, {\n                suite,\n                purpose: new AuthenticationProofPurpose({\n                    challenge,\n                    domain,\n                }),\n                documentLoader: v1_1.default,\n                compactProof: constant.compactProof,\n            }));\n            return signedDidDocument;\n        });\n    }\n    /**\n     * Verifies a signed DIDDocument\n     * @params\n     *  - params.didDocument :   Signed DID Document\n     *  - params.privateKey  :   private key in multibase format (base58 digitalbazar format)\n     *  - params.challenge   :   challenge is a random string generated by the client\n     *  - params.did         :   did of the user\n     *  - params.domain      :   domain is the domain of the DID Document that is being authenticated\n     * @returns Promise<{ verificationResult }> Verification Result\n     */\n    verify(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { didDocument, verificationMethodId, challenge, domain } = params;\n            if (!didDocument) {\n                throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to verify a did');\n            }\n            if (!didDocument['proof']) {\n                throw new Error('HID-SSI-SDK:: Error: params.didDocument.proof is not present in the signed did document');\n            }\n            if (!verificationMethodId) {\n                throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to verify a did');\n            }\n            if (!challenge) {\n                throw new Error('HID-SSI-SDK:: Error: params.challenge is required to verify a did');\n            }\n            const didDoc = didDocument;\n            const publicKeyId = verificationMethodId;\n            const pubkey = didDoc.verificationMethod.find((item) => item.id === publicKeyId);\n            if (!pubkey) {\n                throw new Error('HID-SSI-SDK:: Error: could not find verification method for verificationMethodId: ' +\n                    verificationMethodId +\n                    ' in did document');\n            }\n            const { publicKeyMultibase: publicKeyMultibase1 } = utils_1.default.convertedStableLibKeysIntoEd25519verificationkey2020({\n                publicKey: pubkey.publicKeyMultibase,\n            });\n            const keyPair = yield ed25519_verification_key_2020_1.Ed25519VerificationKey2020.from({\n                id: publicKeyId,\n                publicKeyMultibase: publicKeyMultibase1,\n            });\n            const suite = new ed25519_signature_2020_1.Ed25519Signature2020({\n                key: keyPair,\n            });\n            suite.date = new Date(new Date().getTime() - 100000).toISOString();\n            const controller = {\n                '@context': constant.DID.CONTROLLER_CONTEXT,\n                id: publicKeyId,\n                authentication: didDoc.authentication,\n            };\n            const purpose = new AuthenticationProofPurpose({\n                controller,\n                challenge,\n                domain,\n            });\n            const result = yield jsonld_signatures_1.default.verify(didDoc, {\n                suite,\n                purpose: purpose,\n                documentLoader: v1_1.default,\n                compactProof: constant.compactProof,\n            });\n            return result;\n        });\n    }\n    // using in API\n    createByClientSpec(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this['window'] === 'undefined') {\n                console.log('HID-SSI-SDK:: Warning:  Running in non browser mode');\n            }\n            if (!params.methodSpecificId) {\n                throw new Error('HID-SSI-SDK:: Error: params.methodSpecificId is required to create didoc');\n            }\n            if (!params.chainId) {\n                throw new Error('HID-SSI-SDK:: Error: params.chainId is required to create didoc');\n            }\n            if (!params.address) {\n                throw new Error('HID-SSI-SDK:: Error: params.address is required to create didoc');\n            }\n            if (!params.clientSpec) {\n                throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is required to create didoc');\n            }\n            if (!(params.clientSpec in IDID_1.IClientSpec)) {\n                throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is invalid');\n            }\n            let didDoc;\n            let verificationRelationships = [];\n            if (params.verificationRelationships && params.verificationRelationships.length > 0) {\n                if (params.verificationRelationships.includes(IDID_1.IVerificationRelationships.keyAgreement)) {\n                    throw new Error('HID-SSI-SDK:: Error: keyAgreement is not allowed in verificationRelationships');\n                }\n                verificationRelationships = this._filterVerificationRelationships(params.verificationRelationships);\n            }\n            else {\n                verificationRelationships = this._filterVerificationRelationships([]);\n            }\n            switch (params.clientSpec) {\n                case IDID_1.IClientSpec['eth-personalSign']: {\n                    const blockChainAccountId = this._getBlockChainAccountID(params.chainId, params.address);\n                    const didId = this._getId(params.methodSpecificId);\n                    const newDid = new DIDDocument('', blockChainAccountId, didId, IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020, verificationRelationships);\n                    didDoc = utils_1.default.jsonToLdConvertor(Object.assign({}, newDid));\n                    delete didDoc.service;\n                    break;\n                }\n                case IDID_1.IClientSpec['cosmos-ADR036']: {\n                    if (!params.publicKey) {\n                        throw new Error('HID-SSI-SDK:: Error: params.publicKey is required to create didoc for ' +\n                            IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019);\n                    }\n                    if (!this._isValidMultibaseBase58String(params.publicKey)) {\n                        throw new Error('HID-SSI-SDK:: Error: params.publicKey mustbe multibase encoded base58 string for ' +\n                            IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019);\n                    }\n                    const multibasePublicKey = params.publicKey;\n                    const didId = this._getId(params.methodSpecificId);\n                    const blockChainAccountId = 'cosmos:' + params.chainId + ':' + params.address;\n                    const newDid = new DIDDocument(multibasePublicKey, blockChainAccountId, didId, IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019);\n                    didDoc = utils_1.default.jsonToLdConvertor(Object.assign({}, newDid));\n                    break;\n                }\n                default: {\n                    throw new Error('HID-SSI-SDK:: Error: params.clientSpec is invalid use object.generate() method');\n                }\n            }\n            return didDoc;\n        });\n    }\n    // using in API\n    registerByClientSpec(params) {\n        var _a, _b, _c, _d;\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!params.didDocument || Object.keys(params.didDocument).length === 0) {\n                throw new Error('HID-SSI-SDK:: Error: params.didDocString is required to register a did');\n            }\n            if (!this.didrpc) {\n                throw new Error('HID-SSI-SDK:: Error:  HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n            }\n            if (!params.signInfos) {\n                throw new Error('HID-SSI-SDK:: Error: params.signInfos is required to register a did');\n            }\n            if (params.signInfos.length < 1) {\n                throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n            }\n            if (!params.signInfos) {\n                throw new Error('HID-SSI-SDK:: Error: params.signInfos is required to register a did');\n            }\n            if (params.signInfos.length < 1) {\n                throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n            }\n            for (const i in params.signInfos) {\n                if (!params.signInfos[i].verification_method_id) {\n                    throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].verification_method_id is required to register a did`);\n                }\n                if (!params.signInfos[i].clientSpec) {\n                    throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].clientSpec is required to register a did`);\n                }\n                if (((_a = params.signInfos[i].clientSpec) === null || _a === void 0 ? void 0 : _a.type) === IDID_1.IClientSpec['cosmos-ADR036']) {\n                    if (((_b = params.signInfos[i].clientSpec) === null || _b === void 0 ? void 0 : _b.adr036SignerAddress) === '' ||\n                        ((_c = params.signInfos[i].clientSpec) === null || _c === void 0 ? void 0 : _c.adr036SignerAddress) === undefined) {\n                        throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].adr036SignerAddress is required to register a did, when clientSpec type is${(_d = params.signInfos[i].clientSpec) === null || _d === void 0 ? void 0 : _d.type} `);\n                    }\n                }\n                if (!params.signInfos[i].signature) {\n                    throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].signature is required to register a did`);\n                }\n            }\n            const didDocStringJson = utils_1.default.ldToJsonConvertor(params.didDocument);\n            const didDoc = didDocStringJson;\n            return yield this.didrpc.registerDID(didDoc, params.signInfos);\n        });\n    }\n    // using in API\n    updateByClientSpec(params) {\n        var _a, _b, _c, _d;\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.didrpc) {\n                throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n            }\n            if (!params.didDocument) {\n                throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to update a did');\n            }\n            if (!params.signInfos) {\n                throw new Error('HID-SSI-SDK:: Error: params.signInfos is required to register a did');\n            }\n            if (params.signInfos.length < 1) {\n                throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n            }\n            for (const i in params.signInfos) {\n                if (!params.signInfos[i].verification_method_id) {\n                    throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].verification_method_id is required to register a did`);\n                }\n                if (!params.signInfos[i].clientSpec) {\n                    throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].clientSpec is required to register a did`);\n                }\n                if (((_a = params.signInfos[i].clientSpec) === null || _a === void 0 ? void 0 : _a.type) === IDID_1.IClientSpec['cosmos-ADR036']) {\n                    if (((_b = params.signInfos[i].clientSpec) === null || _b === void 0 ? void 0 : _b.adr036SignerAddress) === '' ||\n                        ((_c = params.signInfos[i].clientSpec) === null || _c === void 0 ? void 0 : _c.adr036SignerAddress) === undefined) {\n                        throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].adr036SignerAddress is required to register a did, when clientSpec type is${(_d = params.signInfos[i].clientSpec) === null || _d === void 0 ? void 0 : _d.type} `);\n                    }\n                }\n                if (!params.signInfos[i].signature) {\n                    throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].signature is required to register a did`);\n                }\n            }\n            if (!params.versionId) {\n                throw new Error('HID-SSI-SDK:: Error: params.versionId is required to update a did');\n            }\n            const { didDocument, signInfos, versionId } = params;\n            return yield this.didrpc.updateDID(didDocument, signInfos, versionId);\n        });\n    }\n    // using in API\n    deactivateByClientSpec(params) {\n        var _a, _b, _c, _d;\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.didrpc) {\n                throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n            }\n            if (!params.didDocument) {\n                throw new Error('HID-SSI-SDK:: Error: params.didDocument is required to deactivate a did');\n            }\n            if (!params.signInfos) {\n                throw new Error('HID-SSI-SDK:: Error: params.signInfos is required to register a did');\n            }\n            if (params.signInfos.length < 1) {\n                throw new Error('HID-SSI-SDK:: Error: params.signInfos must be a non empty array');\n            }\n            for (const i in params.signInfos) {\n                if (!params.signInfos[i].verification_method_id) {\n                    throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].verification_method_id is required to register a did`);\n                }\n                if (!params.signInfos[i].clientSpec) {\n                    throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].clientSpec is required to register a did`);\n                }\n                if (((_a = params.signInfos[i].clientSpec) === null || _a === void 0 ? void 0 : _a.type) === IDID_1.IClientSpec['cosmos-ADR036']) {\n                    if (((_b = params.signInfos[i].clientSpec) === null || _b === void 0 ? void 0 : _b.adr036SignerAddress) === '' ||\n                        ((_c = params.signInfos[i].clientSpec) === null || _c === void 0 ? void 0 : _c.adr036SignerAddress) === undefined) {\n                        throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].adr036SignerAddress is required to register a did, when clientSpec type is${(_d = params.signInfos[i].clientSpec) === null || _d === void 0 ? void 0 : _d.type} `);\n                    }\n                }\n                if (!params.signInfos[i].signature) {\n                    throw new Error(`HID-SSI-SDK:: Error: params.signInfos[${i}].signature is required to register a did`);\n                }\n            }\n            if (!params.versionId) {\n                throw new Error('HID-SSI-SDK:: Error: params.versionId is required to deactivate a did');\n            }\n            // if (!params.clientSpec) {\n            //   throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is required to deactivate');\n            // }\n            // if (!(params.clientSpec in IClientSpec)) {\n            //   throw new Error('HID-SSI-SDK:: Error: invalid clientSpec');\n            // }\n            const { didDocument, signInfos, versionId } = params;\n            const didDoc = didDocument;\n            return yield this.didrpc.deactivateDID(didDoc.id, signInfos, versionId);\n        });\n    }\n    signAndRegisterByClientSpec(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!params.didDocument || Object.keys(params.didDocument).length === 0) {\n                throw new Error('HID-SSI-SDK:: Error: params.didDocString is required to register a did');\n            }\n            if (!params.clientSpec) {\n                throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is required to sign');\n            }\n            if (!(params.clientSpec in IDID_1.IClientSpec)) {\n                throw new Error('HID-SSI-SDK:: Error: invalid clientSpec');\n            }\n            if (!this.didrpc) {\n                throw new Error('HID-SSI-SDK:: Error:  HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n            }\n            if (!params.verificationMethodId) {\n                throw new Error('HID-SSI-SDK:: Error: params.verificationMethodId is required to register a did');\n            }\n            if (!params.web3) {\n                throw new Error('HID-SSI-SDK:: Error: params.web should be passed');\n            }\n            if (!params.address) {\n                throw new Error('HID-SSI-SDK:: Error: params.address is required to sign a did');\n            }\n            const { didDocument, signature } = yield this.signByClientSpec({\n                didDocument: params.didDocument,\n                clientSpec: params.clientSpec,\n                address: params.address,\n                web3: params.web3,\n                chainId: params.chainId,\n            });\n            const signInfos = [\n                {\n                    signature,\n                    verification_method_id: params.verificationMethodId,\n                    clientSpec: {\n                        type: params.clientSpec,\n                        adr036SignerAddress: params.clientSpec === IDID_1.IClientSpec['cosmos-ADR036'] ? params.address : '',\n                    },\n                },\n            ];\n            return yield this.registerByClientSpec({\n                didDocument,\n                signInfos,\n                // only for [cosmos-ADR036]\n            });\n        });\n    }\n    signByClientSpec(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this['window'] === 'undefined') {\n                throw new Error('HID-SSI-SDK:: Error:  Running in non browser mode');\n            }\n            if (!params.didDocument) {\n                throw Error('HID-SSI-SDK:: Error: params.didDocument is required to sign');\n            }\n            if (!params.address) {\n                throw new Error('HID-SSI-SDK:: Error: params.address is required to sign a did');\n            }\n            if (!params.clientSpec) {\n                throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is required to sign');\n            }\n            if (!(params.clientSpec in IDID_1.IClientSpec)) {\n                throw new Error('HID-SSI-SDK:: Error:  params.clientSpec is invalid');\n            }\n            switch (params.clientSpec) {\n                case IDID_1.IClientSpec['eth-personalSign']: {\n                    const didDocStringJson = utils_1.default.ldToJsonConvertor(params.didDocument);\n                    const didDoc = didDocStringJson;\n                    const signature = yield params.web3.eth.personal.sign(JSON.stringify(didDoc, (key, value) => {\n                        if (value === '' || (Array.isArray(value) && value.length === 0)) {\n                            return undefined;\n                        }\n                        return value;\n                    }), params.address);\n                    return { didDocument: didDoc, signature };\n                }\n                case IDID_1.IClientSpec['cosmos-ADR036']: {\n                    if (!params.chainId) {\n                        throw new Error('HID-SSI-SDK:: Error:  params.chainId is required to sign for clientSpec ' +\n                            IDID_1.IClientSpec['cosmos-ADR036'] +\n                            ' and keyType ' +\n                            IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019);\n                    }\n                    const didDocStringJson = utils_1.default.ldToJsonConvertor(params.didDocument);\n                    const didDoc = didDocStringJson;\n                    const didDocBytes = (yield did_1.Did.encode(didDoc)).finish();\n                    const signRespObj = yield params.web3.requestMethod('signArbitrary', [\n                        params.chainId,\n                        params.address,\n                        didDocBytes,\n                    ]);\n                    return { didDocument: didDoc, signature: signRespObj['signature'] };\n                }\n                default:\n                    throw Error('HID-SSI-SDK:: Error: Invalid clientSpec');\n                    break;\n            }\n        });\n    }\n    /**\n     * Add verification method\n     * @param\n     * - params.didDocument          : Optional, unregistered Did document\n     * - params.did                  : Optional, didDoc Id of registered didDoc\n     * - params.type                 : key type\n     * - params.id                   : Optional, verificationMethodId\n     * - params.controller           : Optional, controller field\n     * - params.publicKeyMultibase   : public key\n     * - params.blockchainAccountId  : Optional, blockchain accountId\n     * @return {Promise<Did>}  DidDocument object\n     */\n    addVerificationMethod(params) {\n        var _a, _b, _c;\n        return __awaiter(this, void 0, void 0, function* () {\n            let resolvedDidDoc;\n            if (!params.did && (!params.didDocument || Object.keys(params.didDocument).length === 0)) {\n                throw new Error('HID-SSI_SDK:: Error: params.did or params.didDocument is required to addVerificationMethod');\n            }\n            if (!params.type) {\n                throw new Error('HID-SSI-SDK:: Error: params.type is required to addVerificationMethod');\n            }\n            const { type } = params;\n            if (!(type in IDID_1.IKeyType)) {\n                throw new Error('HID-SSI-SDK:: Error: params.type is invalid');\n            }\n            try {\n                if (params.did) {\n                    if (!this.didrpc) {\n                        throw new Error('HID-SSI-SDK:: Error: HID-SSI-SDK:: Error: HypersignDID class is not instantiated with Offlinesigner or have not been initilized');\n                    }\n                    resolvedDidDoc = yield this.didrpc.resolveDID(params.did);\n                    if (!resolvedDidDoc.didDocument) {\n                        if (!params.didDocument) {\n                            throw new Error('HID-SSI_SDK:: Error: can not able to resolve did please send didDocument');\n                        }\n                    }\n                }\n                else if (params.didDocument) {\n                    resolvedDidDoc = {};\n                    resolvedDidDoc.didDocument = params.didDocument;\n                }\n                else {\n                    throw new Error('HID-SSI-SDK:: Error: params.did or params.didDocument is required to addVerificationMethod');\n                }\n            }\n            catch (e) {\n                throw new Error(`HID-SSI-SDK:: Error: could not resolve did ${params.did}`);\n            }\n            if (type === IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020 &&\n                (!params.blockchainAccountId || params.blockchainAccountId.trim() === '')) {\n                throw new Error(`HID-SSI-SDK:: Error: params.blockchainAccountId is required for keyType ${params.type}`);\n            }\n            if (type === IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020 && (!params.id || params.id.trim() === '')) {\n                throw new Error(`HID-SSI-SDK:: Error: params.id is required for keyType ${params.type}`);\n            }\n            if (type === IDID_1.IKeyType.EcdsaSecp256k1VerificationKey2019 &&\n                (!params.blockchainAccountId ||\n                    params.blockchainAccountId.trim() === '' ||\n                    !params.publicKeyMultibase ||\n                    params.publicKeyMultibase.trim() === '')) {\n                throw new Error(`HID-SSI-SDK:: Error: params.blockchainAccountId and params.publicKeyMultibase is required for keyType ${params.type}`);\n            }\n            if ((type === IDID_1.IKeyType.Ed25519VerificationKey2020 ||\n                type === IDID_1.IKeyType.X25519KeyAgreementKey2020 ||\n                type === IDID_1.IKeyType.X25519KeyAgreementKeyEIP5630) &&\n                !params.publicKeyMultibase) {\n                throw new Error('HID-SSI-SDK:: Error: params.publicKeyMultibase is required to addVerificationMethod');\n            }\n            const verificationMethod = {};\n            const { didDocument } = resolvedDidDoc;\n            if (params.id) {\n                const checkIfVmIdExists = didDocument.verificationMethod.some((vm) => vm.id === params.id);\n                if (checkIfVmIdExists) {\n                    throw new Error(`HID-SSI-SDK:: Error: verificationMethod ${params.id} already exists`);\n                }\n            }\n            const VMLength = didDocument.verificationMethod.length;\n            verificationMethod['id'] = (_a = params === null || params === void 0 ? void 0 : params.id) !== null && _a !== void 0 ? _a : `${didDocument.id}#key-${VMLength + 1}`;\n            verificationMethod['type'] = type;\n            verificationMethod['controller'] = didDocument.id;\n            if (type !== IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020) {\n                if (type === IDID_1.IKeyType.Ed25519VerificationKey2020) {\n                    const { publicKeyMultibase: publicKeyMultibase1 } = utils_1.default.convertEd25519verificationkey2020toStableLibKeysInto({\n                        publicKey: params.publicKeyMultibase,\n                    });\n                    verificationMethod['publicKeyMultibase'] = publicKeyMultibase1;\n                }\n                else {\n                    verificationMethod['publicKeyMultibase'] = (_b = params === null || params === void 0 ? void 0 : params.publicKeyMultibase) !== null && _b !== void 0 ? _b : '';\n                }\n            }\n            verificationMethod['blockchainAccountId'] = (_c = params === null || params === void 0 ? void 0 : params.blockchainAccountId) !== null && _c !== void 0 ? _c : '';\n            didDocument.verificationMethod.push(verificationMethod);\n            if (verificationMethod['type'] === IDID_1.IKeyType.X25519KeyAgreementKey2020 ||\n                verificationMethod['type'] === IDID_1.IKeyType.X25519KeyAgreementKeyEIP5630) {\n                didDocument.keyAgreement.push(verificationMethod['id']);\n            }\n            else {\n                didDocument.authentication.push(verificationMethod['id']);\n                didDocument.assertionMethod.push(verificationMethod['id']);\n                didDocument.capabilityDelegation.push(verificationMethod['id']);\n                didDocument.capabilityInvocation.push(verificationMethod['id']);\n            }\n            if (verificationMethod['type'] === IDID_1.IKeyType.X25519KeyAgreementKey2020) {\n                didDocument['@context'].push(constant['DID_' + IDID_1.IKeyType.Ed25519VerificationKey2020].DID_KEYAGREEMENT_CONTEXT);\n            }\n            if (verificationMethod['type'] === IDID_1.IKeyType.X25519KeyAgreementKeyEIP5630) {\n                didDocument['@context'].push(constant['DID_' + IDID_1.IKeyType.EcdsaSecp256k1RecoveryMethod2020].DID_KEYAGREEMENT_CONTEXT);\n            }\n            return didDocument;\n        });\n    }\n}\nexports.default = HypersignDID;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}