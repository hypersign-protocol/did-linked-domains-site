{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.typed-array.to-reversed.js\");\nrequire(\"core-js/modules/es.typed-array.to-sorted.js\");\nrequire(\"core-js/modules/es.typed-array.with.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.makeMultisignedTx = exports.makeCompactBitArray = void 0;\nconst amino_1 = require(\"@cosmjs/amino\");\nconst encoding_1 = require(\"@cosmjs/encoding\");\nconst proto_signing_1 = require(\"@cosmjs/proto-signing\");\nconst multisig_1 = require(\"cosmjs-types/cosmos/crypto/multisig/v1beta1/multisig\");\nconst signing_1 = require(\"cosmjs-types/cosmos/tx/signing/v1beta1/signing\");\nconst tx_1 = require(\"cosmjs-types/cosmos/tx/v1beta1/tx\");\nconst tx_2 = require(\"cosmjs-types/cosmos/tx/v1beta1/tx\");\nconst long_1 = __importDefault(require(\"long\"));\nfunction makeCompactBitArray(bits) {\n  const byteCount = Math.ceil(bits.length / 8);\n  const extraBits = bits.length - Math.floor(bits.length / 8) * 8;\n  const bytes = new Uint8Array(byteCount); // zero-filled\n  bits.forEach((value, index) => {\n    const bytePos = Math.floor(index / 8);\n    const bitPos = index % 8;\n    // eslint-disable-next-line no-bitwise\n    if (value) bytes[bytePos] |= 0b1 << 8 - 1 - bitPos;\n  });\n  return multisig_1.CompactBitArray.fromPartial({\n    elems: bytes,\n    extraBitsStored: extraBits\n  });\n}\nexports.makeCompactBitArray = makeCompactBitArray;\nfunction makeMultisignedTx(multisigPubkey, sequence, fee, bodyBytes, signatures) {\n  const addresses = Array.from(signatures.keys());\n  const prefix = encoding_1.Bech32.decode(addresses[0]).prefix;\n  const signers = Array(multisigPubkey.value.pubkeys.length).fill(false);\n  const signaturesList = new Array();\n  for (let i = 0; i < multisigPubkey.value.pubkeys.length; i++) {\n    const signerAddress = (0, amino_1.pubkeyToAddress)(multisigPubkey.value.pubkeys[i], prefix);\n    const signature = signatures.get(signerAddress);\n    if (signature) {\n      signers[i] = true;\n      signaturesList.push(signature);\n    }\n  }\n  const signerInfo = {\n    publicKey: (0, proto_signing_1.encodePubkey)(multisigPubkey),\n    modeInfo: {\n      multi: {\n        bitarray: makeCompactBitArray(signers),\n        modeInfos: signaturesList.map(_ => ({\n          single: {\n            mode: signing_1.SignMode.SIGN_MODE_LEGACY_AMINO_JSON\n          }\n        }))\n      }\n    },\n    sequence: long_1.default.fromNumber(sequence)\n  };\n  const authInfo = tx_1.AuthInfo.fromPartial({\n    signerInfos: [signerInfo],\n    fee: {\n      amount: [...fee.amount],\n      gasLimit: long_1.default.fromString(fee.gas)\n    }\n  });\n  const authInfoBytes = tx_1.AuthInfo.encode(authInfo).finish();\n  const signedTx = tx_2.TxRaw.fromPartial({\n    bodyBytes: bodyBytes,\n    authInfoBytes: authInfoBytes,\n    signatures: [multisig_1.MultiSignature.encode(multisig_1.MultiSignature.fromPartial({\n      signatures: signaturesList\n    })).finish()]\n  });\n  return signedTx;\n}\nexports.makeMultisignedTx = makeMultisignedTx;","map":{"version":3,"names":["amino_1","require","encoding_1","proto_signing_1","multisig_1","signing_1","tx_1","tx_2","long_1","__importDefault","makeCompactBitArray","bits","byteCount","Math","ceil","length","extraBits","floor","bytes","Uint8Array","forEach","value","index","bytePos","bitPos","CompactBitArray","fromPartial","elems","extraBitsStored","exports","makeMultisignedTx","multisigPubkey","sequence","fee","bodyBytes","signatures","addresses","Array","from","keys","prefix","Bech32","decode","signers","pubkeys","fill","signaturesList","i","signerAddress","pubkeyToAddress","signature","get","push","signerInfo","publicKey","encodePubkey","modeInfo","multi","bitarray","modeInfos","map","_","single","mode","SignMode","SIGN_MODE_LEGACY_AMINO_JSON","default","fromNumber","authInfo","AuthInfo","signerInfos","amount","gasLimit","fromString","gas","authInfoBytes","encode","finish","signedTx","TxRaw","MultiSignature"],"sources":["../src/multisignature.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}