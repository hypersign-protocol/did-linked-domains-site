{"ast":null,"code":"\"use strict\";\n\nvar _classPrivateFieldInitSpec = require(\"/home/pratap/domain-linkege/node_modules/@babel/runtime/helpers/classPrivateFieldInitSpec.js\").default;\nvar _classPrivateFieldSet = require(\"/home/pratap/domain-linkege/node_modules/@babel/runtime/helpers/classPrivateFieldSet.js\").default;\nvar _classPrivateFieldGet = require(\"/home/pratap/domain-linkege/node_modules/@babel/runtime/helpers/classPrivateFieldGet.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WebSocketProvider = void 0;\nconst ws_js_1 = require(\"./ws.js\"); /*-browser*/\nconst provider_socket_js_1 = require(\"./provider-socket.js\");\n/**\n *  A JSON-RPC provider which is backed by a WebSocket.\n *\n *  WebSockets are often preferred because they retain a live connection\n *  to a server, which permits more instant access to events.\n *\n *  However, this incurs higher server infrasturture costs, so additional\n *  resources may be required to host your own WebSocket nodes and many\n *  third-party services charge additional fees for WebSocket endpoints.\n */\nvar _connect = /*#__PURE__*/new WeakMap();\nvar _websocket = /*#__PURE__*/new WeakMap();\nclass WebSocketProvider extends provider_socket_js_1.SocketProvider {\n  get websocket() {\n    if (_classPrivateFieldGet(this, _websocket) == null) {\n      throw new Error(\"websocket closed\");\n    }\n    return _classPrivateFieldGet(this, _websocket);\n  }\n  constructor(url, network) {\n    super(network);\n    _classPrivateFieldInitSpec(this, _connect, {\n      writable: true,\n      value: void 0\n    });\n    _classPrivateFieldInitSpec(this, _websocket, {\n      writable: true,\n      value: void 0\n    });\n    if (typeof url === \"string\") {\n      _classPrivateFieldSet(this, _connect, () => {\n        return new ws_js_1.WebSocket(url);\n      });\n      _classPrivateFieldSet(this, _websocket, _classPrivateFieldGet(this, _connect).call(this));\n    } else if (typeof url === \"function\") {\n      _classPrivateFieldSet(this, _connect, url);\n      _classPrivateFieldSet(this, _websocket, url());\n    } else {\n      _classPrivateFieldSet(this, _connect, null);\n      _classPrivateFieldSet(this, _websocket, url);\n    }\n    this.websocket.onopen = async () => {\n      try {\n        await this._start();\n        this.resume();\n      } catch (error) {\n        console.log(\"failed to start WebsocketProvider\", error);\n        // @TODO: now what? Attempt reconnect?\n      }\n    };\n\n    this.websocket.onmessage = message => {\n      this._processMessage(message.data);\n    };\n    /*\n            this.websocket.onclose = (event) => {\n                // @TODO: What event.code should we reconnect on?\n                const reconnect = false;\n                if (reconnect) {\n                    this.pause(true);\n                    if (this.#connect) {\n                        this.#websocket = this.#connect();\n                        this.#websocket.onopen = ...\n                        // @TODO: this requires the super class to rebroadcast; move it there\n                    }\n                    this._reconnect();\n                }\n            };\n    */\n  }\n\n  async _write(message) {\n    this.websocket.send(message);\n  }\n  async destroy() {\n    if (_classPrivateFieldGet(this, _websocket) != null) {\n      _classPrivateFieldGet(this, _websocket).close();\n      _classPrivateFieldSet(this, _websocket, null);\n    }\n    super.destroy();\n  }\n}\nexports.WebSocketProvider = WebSocketProvider;","map":{"version":3,"names":["ws_js_1","require","provider_socket_js_1","_connect","WeakMap","_websocket","WebSocketProvider","SocketProvider","websocket","_classPrivateFieldGet","Error","constructor","url","network","_classPrivateFieldInitSpec","writable","value","_classPrivateFieldSet","WebSocket","call","onopen","_start","resume","error","console","log","onmessage","message","_processMessage","data","_write","send","destroy","close","exports"],"sources":["../../src.ts/providers/provider-websocket.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;AAEA,MAAAA,OAAA,GAAAC,OAAA,YAAkD,CAAC;AAEnD,MAAAC,oBAAA,GAAAD,OAAA;AAwBA;;;;;;;;;;AAAA,IAAAE,QAAA,oBAAAC,OAAA;AAAA,IAAAC,UAAA,oBAAAD,OAAA;AAUA,MAAaE,iBAAkB,SAAQJ,oBAAA,CAAAK,cAAc;EAIjD,IAAIC,SAASA,CAAA;IACT,IAAIC,qBAAA,KAAI,EAAAJ,UAAA,KAAe,IAAI,EAAE;MAAE,MAAM,IAAIK,KAAK,CAAC,kBAAkB,CAAC;;IAClE,OAAAD,qBAAA,CAAO,IAAI,EAAAJ,UAAA;EACf;EAEAM,YAAYC,GAA8C,EAAEC,OAAoB;IAC5E,KAAK,CAACA,OAAO,CAAC;IAACC,0BAAA,OAAAX,QAAA;MAAAY,QAAA;MAAAC,KAAA;IAAA;IAAAF,0BAAA,OAAAT,UAAA;MAAAU,QAAA;MAAAC,KAAA;IAAA;IACf,IAAI,OAAOJ,GAAI,KAAK,QAAQ,EAAE;MAC1BK,qBAAA,KAAI,EAAAd,QAAA,EAAY,MAAK;QAAG,OAAO,IAAIH,OAAA,CAAAkB,SAAU,CAACN,GAAG,CAAC;MAAE,CAAC;MACrDK,qBAAA,KAAI,EAAAZ,UAAA,EAAAI,qBAAA,CAAc,IAAI,EAAAN,QAAA,EAAAgB,IAAA,CAAJ,IAAI;KACzB,MAAM,IAAI,OAAOP,GAAI,KAAK,UAAU,EAAE;MACnCK,qBAAA,KAAI,EAAAd,QAAA,EAAYS,GAAG;MACnBK,qBAAA,KAAI,EAAAZ,UAAA,EAAcO,GAAG,EAAE;KAC1B,MAAM;MACHK,qBAAA,KAAI,EAAAd,QAAA,EAAY,IAAI;MACpBc,qBAAA,KAAI,EAAAZ,UAAA,EAAcO,GAAG;;IAGzB,IAAI,CAACJ,SAAS,CAACY,MAAM,GAAG,YAAW;MAC/B,IAAI;QACA,MAAM,IAAI,CAACC,MAAM,EAAE;QACnB,IAAI,CAACC,MAAM,EAAE;OAChB,CAAC,OAAOC,KAAK,EAAE;QACZC,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEF,KAAK,CAAC;QACvD;;IAER,CAAC;;IAED,IAAI,CAACf,SAAS,CAACkB,SAAS,GAAIC,OAAyB,IAAI;MACrD,IAAI,CAACC,eAAe,CAACD,OAAO,CAACE,IAAI,CAAC;IACtC,CAAC;IACT;;;;;;;;;;;;;;;EAeI;;EAEA,MAAMC,MAAMA,CAACH,OAAe;IACxB,IAAI,CAACnB,SAAS,CAACuB,IAAI,CAACJ,OAAO,CAAC;EAChC;EAEA,MAAMK,OAAOA,CAAA;IACT,IAAIvB,qBAAA,KAAI,EAAAJ,UAAA,KAAe,IAAI,EAAE;MACzBI,qBAAA,KAAI,EAAAJ,UAAA,EAAY4B,KAAK,EAAE;MACvBhB,qBAAA,KAAI,EAAAZ,UAAA,EAAc,IAAI;;IAE1B,KAAK,CAAC2B,OAAO,EAAE;EACnB;;AA9DJE,OAAA,CAAA5B,iBAAA,GAAAA,iBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}