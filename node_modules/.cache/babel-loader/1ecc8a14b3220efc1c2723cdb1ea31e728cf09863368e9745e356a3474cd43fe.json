{"ast":null,"code":"import \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\n/*!\n * Copyright (c) 2021 Digital Bazaar, Inc. All rights reserved.\n */\nimport * as base58btc from 'base58-universal';\nimport * as base64url from 'base64url-universal';\nimport { assertKeyBytes } from './validators.js';\nimport ed25519 from './ed25519.js';\nimport { LDKeyPair } from 'crypto-ld';\nconst SUITE_ID = 'Ed25519VerificationKey2020';\n// multibase base58-btc header\nconst MULTIBASE_BASE58BTC_HEADER = 'z';\n// multicodec ed25519-pub header as varint\nconst MULTICODEC_ED25519_PUB_HEADER = new Uint8Array([0xed, 0x01]);\n// multicodec ed25519-priv header as varint\nconst MULTICODEC_ED25519_PRIV_HEADER = new Uint8Array([0x80, 0x26]);\nexport class Ed25519VerificationKey2020 extends LDKeyPair {\n  /**\n   * An implementation of the Ed25519VerificationKey2020 spec, for use with\n   * Linked Data Proofs.\n   *\n   * @see https://w3c-ccg.github.io/lds-ed25519-2020/#ed25519verificationkey2020\n   * @see https://github.com/digitalbazaar/jsonld-signatures\n   *\n   * @param {object} options - Options hashmap.\n   * @param {string} options.controller - Controller DID or document url.\n   * @param {string} [options.id] - The key ID. If not provided, will be\n   *   composed of controller and key fingerprint as hash fragment.\n   * @param {string} options.publicKeyMultibase - Multibase encoded public key\n   *   with a multicodec ed25519-pub varint header [0xed, 0x01].\n   * @param {string} [options.privateKeyMultibase] - Multibase private key\n   *   with a multicodec ed25519-priv varint header [0x80, 0x26].\n   * @param {string} [options.revoked] - Timestamp of when the key has been\n   *   revoked, in RFC3339 format. If not present, the key itself is considered\n   *   not revoked. Note that this mechanism is slightly different than DID\n   *   Document key revocation, where a DID controller can revoke a key from\n   *   that DID by removing it from the DID Document.\n   */\n  constructor(options = {}) {\n    super(options);\n    this.type = SUITE_ID;\n    const {\n      publicKeyMultibase,\n      privateKeyMultibase\n    } = options;\n    if (!publicKeyMultibase) {\n      throw new TypeError('The \"publicKeyMultibase\" property is required.');\n    }\n    if (!publicKeyMultibase || !_isValidKeyHeader(publicKeyMultibase, MULTICODEC_ED25519_PUB_HEADER)) {\n      throw new Error('\"publicKeyMultibase\" has invalid header bytes: ' + `\"${publicKeyMultibase}\".`);\n    }\n    if (privateKeyMultibase && !_isValidKeyHeader(privateKeyMultibase, MULTICODEC_ED25519_PRIV_HEADER)) {\n      throw new Error('\"privateKeyMultibase\" has invalid header bytes.');\n    }\n\n    // assign valid key values\n    this.publicKeyMultibase = publicKeyMultibase;\n    this.privateKeyMultibase = privateKeyMultibase;\n\n    // set key identifier if controller is provided\n    if (this.controller && !this.id) {\n      this.id = `${this.controller}#${this.fingerprint()}`;\n    }\n    // check that the passed in keyBytes are 32 bytes\n    assertKeyBytes({\n      bytes: this._publicKeyBuffer,\n      code: 'invalidPublicKeyLength',\n      expectedLength: 32\n    });\n  }\n\n  /**\n   * Creates an Ed25519 Key Pair from an existing serialized key pair.\n   *\n   * @param {object} options - Key pair options (see constructor).\n   * @example\n   * > const keyPair = await Ed25519VerificationKey2020.from({\n   * controller: 'did:ex:1234',\n   * type: 'Ed25519VerificationKey2020',\n   * publicKeyMultibase,\n   * privateKeyMultibase\n   * });\n   *\n   * @returns {Promise<Ed25519VerificationKey2020>} An Ed25519 Key Pair.\n   */\n  static async from(options) {\n    if (options.type === 'Ed25519VerificationKey2018') {\n      return Ed25519VerificationKey2020.fromEd25519VerificationKey2018(options);\n    }\n    if (options.type === 'JsonWebKey2020') {\n      return Ed25519VerificationKey2020.fromJsonWebKey2020(options);\n    }\n    return new Ed25519VerificationKey2020(options);\n  }\n\n  /**\n   * Instance creation method for backwards compatibility with the\n   * `Ed25519VerificationKey2018` key suite.\n   *\n   * @see https://github.com/digitalbazaar/ed25519-verification-key-2018\n   * @typedef {object} Ed25519VerificationKey2018\n   * @param {Ed25519VerificationKey2018} keyPair - Ed25519 2018 suite key pair.\n   *\n   * @returns {Ed25519VerificationKey2020} - 2020 suite instance.\n   */\n  static fromEd25519VerificationKey2018({\n    keyPair\n  } = {}) {\n    const publicKeyMultibase = _encodeMbKey(MULTICODEC_ED25519_PUB_HEADER, base58btc.decode(keyPair.publicKeyBase58));\n    const keyPair2020 = new Ed25519VerificationKey2020({\n      id: keyPair.id,\n      controller: keyPair.controller,\n      publicKeyMultibase\n    });\n    if (keyPair.privateKeyBase58) {\n      keyPair2020.privateKeyMultibase = _encodeMbKey(MULTICODEC_ED25519_PRIV_HEADER, base58btc.decode(keyPair.privateKeyBase58));\n    }\n    return keyPair2020;\n  }\n\n  /**\n   * Creates a key pair instance (public key only) from a JsonWebKey2020\n   * object.\n   *\n   * @see https://w3c-ccg.github.io/lds-jws2020/#json-web-key-2020\n   *\n   * @param {object} options - Options hashmap.\n   * @param {string} options.id - Key id.\n   * @param {string} options.type - Key suite type.\n   * @param {string} options.controller - Key controller.\n   * @param {object} options.publicKeyJwk - JWK object.\n   *\n   * @returns {Promise<Ed25519VerificationKey2020>} Resolves with key pair.\n   */\n  static fromJsonWebKey2020({\n    id,\n    type,\n    controller,\n    publicKeyJwk\n  } = {}) {\n    if (type !== 'JsonWebKey2020') {\n      throw new TypeError(`Invalid key type: \"${type}\".`);\n    }\n    if (!publicKeyJwk) {\n      throw new TypeError('\"publicKeyJwk\" property is required.');\n    }\n    const {\n      kty,\n      crv\n    } = publicKeyJwk;\n    if (kty !== 'OKP') {\n      throw new TypeError('\"kty\" is required to be \"OKP\".');\n    }\n    if (crv !== 'Ed25519') {\n      throw new TypeError('\"crv\" is required to be \"Ed25519\".');\n    }\n    const {\n      x: publicKeyBase64Url\n    } = publicKeyJwk;\n    const publicKeyMultibase = _encodeMbKey(MULTICODEC_ED25519_PUB_HEADER, base64url.decode(publicKeyBase64Url));\n    return Ed25519VerificationKey2020.from({\n      id,\n      controller,\n      publicKeyMultibase\n    });\n  }\n\n  /**\n   * Generates a KeyPair with an optional deterministic seed.\n   *\n   * @param {object} [options={}] - Options hashmap.\n   * @param {Uint8Array} [options.seed] - A 32-byte array seed for a\n   *   deterministic key.\n   *\n   * @returns {Promise<Ed25519VerificationKey2020>} Resolves with generated\n   *   public/private key pair.\n   */\n  static async generate({\n    seed,\n    ...keyPairOptions\n  } = {}) {\n    let keyObject;\n    if (seed) {\n      keyObject = await ed25519.generateKeyPairFromSeed(seed);\n    } else {\n      keyObject = await ed25519.generateKeyPair();\n    }\n    const publicKeyMultibase = _encodeMbKey(MULTICODEC_ED25519_PUB_HEADER, keyObject.publicKey);\n    const privateKeyMultibase = _encodeMbKey(MULTICODEC_ED25519_PRIV_HEADER, keyObject.secretKey);\n    return new Ed25519VerificationKey2020({\n      publicKeyMultibase,\n      privateKeyMultibase,\n      ...keyPairOptions\n    });\n  }\n\n  /**\n   * Creates an instance of Ed25519VerificationKey2020 from a key fingerprint.\n   *\n   * @param {object} options - Options hashmap.\n   * @param {string} options.fingerprint - Multibase encoded key fingerprint.\n   *\n   * @returns {Ed25519VerificationKey2020} Returns key pair instance (with\n   *   public key only).\n   */\n  static fromFingerprint({\n    fingerprint\n  } = {}) {\n    return new Ed25519VerificationKey2020({\n      publicKeyMultibase: fingerprint\n    });\n  }\n\n  /**\n   * @returns {Uint8Array} Public key bytes.\n   */\n  get _publicKeyBuffer() {\n    if (!this.publicKeyMultibase) {\n      return;\n    }\n    // remove multibase header\n    const publicKeyMulticodec = base58btc.decode(this.publicKeyMultibase.substr(1));\n    // remove multicodec header\n    const publicKeyBytes = publicKeyMulticodec.slice(MULTICODEC_ED25519_PUB_HEADER.length);\n    return publicKeyBytes;\n  }\n\n  /**\n   * @returns {Uint8Array} Private key bytes.\n   */\n  get _privateKeyBuffer() {\n    if (!this.privateKeyMultibase) {\n      return;\n    }\n    // remove multibase header\n    const privateKeyMulticodec = base58btc.decode(this.privateKeyMultibase.substr(1));\n    // remove multicodec header\n    const privateKeyBytes = privateKeyMulticodec.slice(MULTICODEC_ED25519_PRIV_HEADER.length);\n    return privateKeyBytes;\n  }\n\n  /**\n   * Generates and returns a multiformats encoded\n   * ed25519 public key fingerprint (for use with cryptonyms, for example).\n   *\n   * @see https://github.com/multiformats/multicodec\n   *\n   * @returns {string} The fingerprint.\n   */\n  fingerprint() {\n    return this.publicKeyMultibase;\n  }\n\n  /**\n   * Exports the serialized representation of the KeyPair\n   * and other information that JSON-LD Signatures can use to form a proof.\n   *\n   * @param {object} [options={}] - Options hashmap.\n   * @param {boolean} [options.publicKey] - Export public key material?\n   * @param {boolean} [options.privateKey] - Export private key material?\n   * @param {boolean} [options.includeContext] - Include JSON-LD context?\n   *\n   * @returns {object} A plain js object that's ready for serialization\n   *   (to JSON, etc), for use in DIDs, Linked Data Proofs, etc.\n   */\n  export({\n    publicKey = false,\n    privateKey = false,\n    includeContext = false\n  } = {}) {\n    if (!(publicKey || privateKey)) {\n      throw new TypeError('Export requires specifying either \"publicKey\" or \"privateKey\".');\n    }\n    const exportedKey = {\n      id: this.id,\n      type: this.type\n    };\n    if (includeContext) {\n      exportedKey['@context'] = Ed25519VerificationKey2020.SUITE_CONTEXT;\n    }\n    if (this.controller) {\n      exportedKey.controller = this.controller;\n    }\n    if (publicKey) {\n      exportedKey.publicKeyMultibase = this.publicKeyMultibase;\n    }\n    if (privateKey) {\n      exportedKey.privateKeyMultibase = this.privateKeyMultibase;\n    }\n    if (this.revoked) {\n      exportedKey.revoked = this.revoked;\n    }\n    return exportedKey;\n  }\n\n  /**\n   * Returns the JWK representation of this key pair.\n   *\n   * @see https://datatracker.ietf.org/doc/html/rfc8037\n   *\n   * @param {object} [options={}] - Options hashmap.\n   * @param {boolean} [options.publicKey] - Include public key?\n   * @param {boolean} [options.privateKey] - Include private key?\n   *\n   * @returns {{kty: string, crv: string, x: string, d: string}} JWK\n   *   representation.\n   */\n  toJwk({\n    publicKey = true,\n    privateKey = false\n  } = {}) {\n    if (!(publicKey || privateKey)) {\n      throw TypeError('Either a \"publicKey\" or a \"privateKey\" is required.');\n    }\n    const jwk = {\n      crv: 'Ed25519',\n      kty: 'OKP'\n    };\n    if (publicKey) {\n      jwk.x = base64url.encode(this._publicKeyBuffer);\n    }\n    if (privateKey) {\n      jwk.d = base64url.encode(this._privateKeyBuffer);\n    }\n    return jwk;\n  }\n\n  /**\n   * @see https://datatracker.ietf.org/doc/html/rfc8037#appendix-A.3\n   *\n   * @returns {Promise<string>} JWK Thumbprint.\n   */\n  async jwkThumbprint() {\n    const publicKey = base64url.encode(this._publicKeyBuffer);\n    const serialized = `{\"crv\":\"Ed25519\",\"kty\":\"OKP\",\"x\":\"${publicKey}\"}`;\n    const data = new TextEncoder().encode(serialized);\n    return base64url.encode(new Uint8Array(await ed25519.sha256digest({\n      data\n    })));\n  }\n\n  /**\n   * Returns the JsonWebKey2020 representation of this key pair.\n   *\n   * @see https://w3c-ccg.github.io/lds-jws2020/#json-web-key-2020\n   *\n   * @returns {Promise<object>} JsonWebKey2020 representation.\n   */\n  async toJsonWebKey2020() {\n    return {\n      '@context': 'https://w3id.org/security/jws/v1',\n      id: this.controller + '#' + (await this.jwkThumbprint()),\n      type: 'JsonWebKey2020',\n      controller: this.controller,\n      publicKeyJwk: this.toJwk({\n        publicKey: true\n      })\n    };\n  }\n\n  /**\n   * Tests whether the fingerprint was generated from a given key pair.\n   *\n   * @example\n   * > edKeyPair.verifyFingerprint({fingerprint: 'z6Mk2S2Q...6MkaFJewa'});\n   * {valid: true};\n   *\n   * @param {object} options - Options hashmap.\n   * @param {string} options.fingerprint - A public key fingerprint.\n   *\n   * @returns {{valid: boolean, error: *}} Result of verification.\n   */\n  verifyFingerprint({\n    fingerprint\n  } = {}) {\n    // fingerprint should have multibase base58-btc header\n    if (!(typeof fingerprint === 'string' && fingerprint[0] === MULTIBASE_BASE58BTC_HEADER)) {\n      return {\n        error: new Error('\"fingerprint\" must be a multibase encoded string.'),\n        valid: false\n      };\n    }\n    let fingerprintBuffer;\n    try {\n      fingerprintBuffer = base58btc.decode(fingerprint.substr(1));\n      if (!fingerprintBuffer) {\n        throw new TypeError('Invalid encoding of fingerprint.');\n      }\n    } catch (e) {\n      return {\n        error: e,\n        valid: false\n      };\n    }\n    const buffersEqual = _isEqualBuffer(this._publicKeyBuffer, fingerprintBuffer.slice(2));\n\n    // validate the first two multicodec bytes\n    const valid = fingerprintBuffer[0] === MULTICODEC_ED25519_PUB_HEADER[0] && fingerprintBuffer[1] === MULTICODEC_ED25519_PUB_HEADER[1] && buffersEqual;\n    if (!valid) {\n      return {\n        error: new Error('The fingerprint does not match the public key.'),\n        valid: false\n      };\n    }\n    return {\n      valid\n    };\n  }\n  signer() {\n    const privateKeyBuffer = this._privateKeyBuffer;\n    return {\n      async sign({\n        data\n      }) {\n        if (!privateKeyBuffer) {\n          throw new Error('A private key is not available for signing.');\n        }\n        return ed25519.sign(privateKeyBuffer, data);\n      },\n      id: this.id\n    };\n  }\n  verifier() {\n    const publicKeyBuffer = this._publicKeyBuffer;\n    return {\n      async verify({\n        data,\n        signature\n      }) {\n        if (!publicKeyBuffer) {\n          throw new Error('A public key is not available for verifying.');\n        }\n        return ed25519.verify(publicKeyBuffer, data, signature);\n      },\n      id: this.id\n    };\n  }\n}\n// Used by CryptoLD harness for dispatching.\nEd25519VerificationKey2020.suite = SUITE_ID;\n// Used by CryptoLD harness's fromKeyId() method.\nEd25519VerificationKey2020.SUITE_CONTEXT = 'https://w3id.org/security/suites/ed25519-2020/v1';\n\n// check to ensure that two buffers are byte-for-byte equal\n// WARNING: this function must only be used to check public information as\n//          timing attacks can be used for non-constant time checks on\n//          secret information.\nfunction _isEqualBuffer(buf1, buf2) {\n  if (buf1.length !== buf2.length) {\n    return false;\n  }\n  for (let i = 0; i < buf1.length; i++) {\n    if (buf1[i] !== buf2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// check a multibase key for an expected header\nfunction _isValidKeyHeader(multibaseKey, expectedHeader) {\n  if (!(typeof multibaseKey === 'string' && multibaseKey[0] === MULTIBASE_BASE58BTC_HEADER)) {\n    return false;\n  }\n  const keyBytes = base58btc.decode(multibaseKey.slice(1));\n  return expectedHeader.every((val, i) => keyBytes[i] === val);\n}\n\n// encode a multibase base58-btc multicodec key\nfunction _encodeMbKey(header, key) {\n  const mbKey = new Uint8Array(header.length + key.length);\n  mbKey.set(header);\n  mbKey.set(key, header.length);\n  return MULTIBASE_BASE58BTC_HEADER + base58btc.encode(mbKey);\n}","map":{"version":3,"names":["base58btc","base64url","assertKeyBytes","ed25519","LDKeyPair","SUITE_ID","MULTIBASE_BASE58BTC_HEADER","MULTICODEC_ED25519_PUB_HEADER","Uint8Array","MULTICODEC_ED25519_PRIV_HEADER","Ed25519VerificationKey2020","constructor","options","type","publicKeyMultibase","privateKeyMultibase","TypeError","_isValidKeyHeader","Error","controller","id","fingerprint","bytes","_publicKeyBuffer","code","expectedLength","from","fromEd25519VerificationKey2018","fromJsonWebKey2020","keyPair","_encodeMbKey","decode","publicKeyBase58","keyPair2020","privateKeyBase58","publicKeyJwk","kty","crv","x","publicKeyBase64Url","generate","seed","keyPairOptions","keyObject","generateKeyPairFromSeed","generateKeyPair","publicKey","secretKey","fromFingerprint","publicKeyMulticodec","substr","publicKeyBytes","slice","length","_privateKeyBuffer","privateKeyMulticodec","privateKeyBytes","export","privateKey","includeContext","exportedKey","SUITE_CONTEXT","revoked","toJwk","jwk","encode","d","jwkThumbprint","serialized","data","TextEncoder","sha256digest","toJsonWebKey2020","verifyFingerprint","error","valid","fingerprintBuffer","e","buffersEqual","_isEqualBuffer","signer","privateKeyBuffer","sign","verifier","publicKeyBuffer","verify","signature","suite","buf1","buf2","i","multibaseKey","expectedHeader","keyBytes","every","val","header","key","mbKey","set"],"sources":["/home/pratap/did-linked-domain/node_modules/@digitalbazaar/ed25519-verification-key-2020/lib/Ed25519VerificationKey2020.js"],"sourcesContent":["/*!\n * Copyright (c) 2021 Digital Bazaar, Inc. All rights reserved.\n */\nimport * as base58btc from 'base58-universal';\nimport * as base64url from 'base64url-universal';\nimport {assertKeyBytes} from './validators.js';\nimport ed25519 from './ed25519.js';\nimport {LDKeyPair} from 'crypto-ld';\n\nconst SUITE_ID = 'Ed25519VerificationKey2020';\n// multibase base58-btc header\nconst MULTIBASE_BASE58BTC_HEADER = 'z';\n// multicodec ed25519-pub header as varint\nconst MULTICODEC_ED25519_PUB_HEADER = new Uint8Array([0xed, 0x01]);\n// multicodec ed25519-priv header as varint\nconst MULTICODEC_ED25519_PRIV_HEADER = new Uint8Array([0x80, 0x26]);\n\nexport class Ed25519VerificationKey2020 extends LDKeyPair {\n  /**\n   * An implementation of the Ed25519VerificationKey2020 spec, for use with\n   * Linked Data Proofs.\n   *\n   * @see https://w3c-ccg.github.io/lds-ed25519-2020/#ed25519verificationkey2020\n   * @see https://github.com/digitalbazaar/jsonld-signatures\n   *\n   * @param {object} options - Options hashmap.\n   * @param {string} options.controller - Controller DID or document url.\n   * @param {string} [options.id] - The key ID. If not provided, will be\n   *   composed of controller and key fingerprint as hash fragment.\n   * @param {string} options.publicKeyMultibase - Multibase encoded public key\n   *   with a multicodec ed25519-pub varint header [0xed, 0x01].\n   * @param {string} [options.privateKeyMultibase] - Multibase private key\n   *   with a multicodec ed25519-priv varint header [0x80, 0x26].\n   * @param {string} [options.revoked] - Timestamp of when the key has been\n   *   revoked, in RFC3339 format. If not present, the key itself is considered\n   *   not revoked. Note that this mechanism is slightly different than DID\n   *   Document key revocation, where a DID controller can revoke a key from\n   *   that DID by removing it from the DID Document.\n   */\n  constructor(options = {}) {\n    super(options);\n    this.type = SUITE_ID;\n    const {publicKeyMultibase, privateKeyMultibase} = options;\n\n    if(!publicKeyMultibase) {\n      throw new TypeError('The \"publicKeyMultibase\" property is required.');\n    }\n\n    if(!publicKeyMultibase || !_isValidKeyHeader(\n      publicKeyMultibase, MULTICODEC_ED25519_PUB_HEADER)) {\n      throw new Error(\n        '\"publicKeyMultibase\" has invalid header bytes: ' +\n        `\"${publicKeyMultibase}\".`);\n    }\n\n    if(privateKeyMultibase && !_isValidKeyHeader(\n      privateKeyMultibase, MULTICODEC_ED25519_PRIV_HEADER)) {\n      throw new Error('\"privateKeyMultibase\" has invalid header bytes.');\n    }\n\n    // assign valid key values\n    this.publicKeyMultibase = publicKeyMultibase;\n    this.privateKeyMultibase = privateKeyMultibase;\n\n    // set key identifier if controller is provided\n    if(this.controller && !this.id) {\n      this.id = `${this.controller}#${this.fingerprint()}`;\n    }\n    // check that the passed in keyBytes are 32 bytes\n    assertKeyBytes({\n      bytes: this._publicKeyBuffer,\n      code: 'invalidPublicKeyLength',\n      expectedLength: 32\n    });\n  }\n\n  /**\n   * Creates an Ed25519 Key Pair from an existing serialized key pair.\n   *\n   * @param {object} options - Key pair options (see constructor).\n   * @example\n   * > const keyPair = await Ed25519VerificationKey2020.from({\n   * controller: 'did:ex:1234',\n   * type: 'Ed25519VerificationKey2020',\n   * publicKeyMultibase,\n   * privateKeyMultibase\n   * });\n   *\n   * @returns {Promise<Ed25519VerificationKey2020>} An Ed25519 Key Pair.\n   */\n  static async from(options) {\n    if(options.type === 'Ed25519VerificationKey2018') {\n      return Ed25519VerificationKey2020.fromEd25519VerificationKey2018(options);\n    }\n    if(options.type === 'JsonWebKey2020') {\n      return Ed25519VerificationKey2020.fromJsonWebKey2020(options);\n    }\n    return new Ed25519VerificationKey2020(options);\n  }\n\n  /**\n   * Instance creation method for backwards compatibility with the\n   * `Ed25519VerificationKey2018` key suite.\n   *\n   * @see https://github.com/digitalbazaar/ed25519-verification-key-2018\n   * @typedef {object} Ed25519VerificationKey2018\n   * @param {Ed25519VerificationKey2018} keyPair - Ed25519 2018 suite key pair.\n   *\n   * @returns {Ed25519VerificationKey2020} - 2020 suite instance.\n   */\n  static fromEd25519VerificationKey2018({keyPair} = {}) {\n    const publicKeyMultibase = _encodeMbKey(\n      MULTICODEC_ED25519_PUB_HEADER, base58btc.decode(keyPair.publicKeyBase58));\n    const keyPair2020 = new Ed25519VerificationKey2020({\n      id: keyPair.id,\n      controller: keyPair.controller,\n      publicKeyMultibase\n    });\n\n    if(keyPair.privateKeyBase58) {\n      keyPair2020.privateKeyMultibase = _encodeMbKey(\n        MULTICODEC_ED25519_PRIV_HEADER,\n        base58btc.decode(keyPair.privateKeyBase58));\n    }\n\n    return keyPair2020;\n  }\n\n  /**\n   * Creates a key pair instance (public key only) from a JsonWebKey2020\n   * object.\n   *\n   * @see https://w3c-ccg.github.io/lds-jws2020/#json-web-key-2020\n   *\n   * @param {object} options - Options hashmap.\n   * @param {string} options.id - Key id.\n   * @param {string} options.type - Key suite type.\n   * @param {string} options.controller - Key controller.\n   * @param {object} options.publicKeyJwk - JWK object.\n   *\n   * @returns {Promise<Ed25519VerificationKey2020>} Resolves with key pair.\n   */\n  static fromJsonWebKey2020({id, type, controller, publicKeyJwk} = {}) {\n    if(type !== 'JsonWebKey2020') {\n      throw new TypeError(`Invalid key type: \"${type}\".`);\n    }\n    if(!publicKeyJwk) {\n      throw new TypeError('\"publicKeyJwk\" property is required.');\n    }\n    const {kty, crv} = publicKeyJwk;\n    if(kty !== 'OKP') {\n      throw new TypeError('\"kty\" is required to be \"OKP\".');\n    }\n    if(crv !== 'Ed25519') {\n      throw new TypeError('\"crv\" is required to be \"Ed25519\".');\n    }\n    const {x: publicKeyBase64Url} = publicKeyJwk;\n    const publicKeyMultibase = _encodeMbKey(\n      MULTICODEC_ED25519_PUB_HEADER,\n      base64url.decode(publicKeyBase64Url));\n\n    return Ed25519VerificationKey2020.from({\n      id, controller, publicKeyMultibase\n    });\n  }\n\n  /**\n   * Generates a KeyPair with an optional deterministic seed.\n   *\n   * @param {object} [options={}] - Options hashmap.\n   * @param {Uint8Array} [options.seed] - A 32-byte array seed for a\n   *   deterministic key.\n   *\n   * @returns {Promise<Ed25519VerificationKey2020>} Resolves with generated\n   *   public/private key pair.\n   */\n  static async generate({seed, ...keyPairOptions} = {}) {\n    let keyObject;\n    if(seed) {\n      keyObject = await ed25519.generateKeyPairFromSeed(seed);\n    } else {\n      keyObject = await ed25519.generateKeyPair();\n    }\n    const publicKeyMultibase =\n      _encodeMbKey(MULTICODEC_ED25519_PUB_HEADER, keyObject.publicKey);\n\n    const privateKeyMultibase =\n      _encodeMbKey(MULTICODEC_ED25519_PRIV_HEADER, keyObject.secretKey);\n\n    return new Ed25519VerificationKey2020({\n      publicKeyMultibase,\n      privateKeyMultibase,\n      ...keyPairOptions\n    });\n  }\n\n  /**\n   * Creates an instance of Ed25519VerificationKey2020 from a key fingerprint.\n   *\n   * @param {object} options - Options hashmap.\n   * @param {string} options.fingerprint - Multibase encoded key fingerprint.\n   *\n   * @returns {Ed25519VerificationKey2020} Returns key pair instance (with\n   *   public key only).\n   */\n  static fromFingerprint({fingerprint} = {}) {\n    return new Ed25519VerificationKey2020({publicKeyMultibase: fingerprint});\n  }\n\n  /**\n   * @returns {Uint8Array} Public key bytes.\n   */\n  get _publicKeyBuffer() {\n    if(!this.publicKeyMultibase) {\n      return;\n    }\n    // remove multibase header\n    const publicKeyMulticodec =\n      base58btc.decode(this.publicKeyMultibase.substr(1));\n    // remove multicodec header\n    const publicKeyBytes =\n      publicKeyMulticodec.slice(MULTICODEC_ED25519_PUB_HEADER.length);\n\n    return publicKeyBytes;\n  }\n\n  /**\n   * @returns {Uint8Array} Private key bytes.\n   */\n  get _privateKeyBuffer() {\n    if(!this.privateKeyMultibase) {\n      return;\n    }\n    // remove multibase header\n    const privateKeyMulticodec =\n      base58btc.decode(this.privateKeyMultibase.substr(1));\n    // remove multicodec header\n    const privateKeyBytes =\n      privateKeyMulticodec.slice(MULTICODEC_ED25519_PRIV_HEADER.length);\n\n    return privateKeyBytes;\n  }\n\n  /**\n   * Generates and returns a multiformats encoded\n   * ed25519 public key fingerprint (for use with cryptonyms, for example).\n   *\n   * @see https://github.com/multiformats/multicodec\n   *\n   * @returns {string} The fingerprint.\n   */\n  fingerprint() {\n    return this.publicKeyMultibase;\n  }\n\n  /**\n   * Exports the serialized representation of the KeyPair\n   * and other information that JSON-LD Signatures can use to form a proof.\n   *\n   * @param {object} [options={}] - Options hashmap.\n   * @param {boolean} [options.publicKey] - Export public key material?\n   * @param {boolean} [options.privateKey] - Export private key material?\n   * @param {boolean} [options.includeContext] - Include JSON-LD context?\n   *\n   * @returns {object} A plain js object that's ready for serialization\n   *   (to JSON, etc), for use in DIDs, Linked Data Proofs, etc.\n   */\n  export({publicKey = false, privateKey = false, includeContext = false} = {}) {\n    if(!(publicKey || privateKey)) {\n      throw new TypeError(\n        'Export requires specifying either \"publicKey\" or \"privateKey\".');\n    }\n    const exportedKey = {\n      id: this.id,\n      type: this.type\n    };\n    if(includeContext) {\n      exportedKey['@context'] = Ed25519VerificationKey2020.SUITE_CONTEXT;\n    }\n    if(this.controller) {\n      exportedKey.controller = this.controller;\n    }\n    if(publicKey) {\n      exportedKey.publicKeyMultibase = this.publicKeyMultibase;\n    }\n    if(privateKey) {\n      exportedKey.privateKeyMultibase = this.privateKeyMultibase;\n    }\n    if(this.revoked) {\n      exportedKey.revoked = this.revoked;\n    }\n    return exportedKey;\n  }\n\n  /**\n   * Returns the JWK representation of this key pair.\n   *\n   * @see https://datatracker.ietf.org/doc/html/rfc8037\n   *\n   * @param {object} [options={}] - Options hashmap.\n   * @param {boolean} [options.publicKey] - Include public key?\n   * @param {boolean} [options.privateKey] - Include private key?\n   *\n   * @returns {{kty: string, crv: string, x: string, d: string}} JWK\n   *   representation.\n   */\n  toJwk({publicKey = true, privateKey = false} = {}) {\n    if(!(publicKey || privateKey)) {\n      throw TypeError('Either a \"publicKey\" or a \"privateKey\" is required.');\n    }\n    const jwk = {crv: 'Ed25519', kty: 'OKP'};\n    if(publicKey) {\n      jwk.x = base64url.encode(this._publicKeyBuffer);\n    }\n    if(privateKey) {\n      jwk.d = base64url.encode(this._privateKeyBuffer);\n    }\n    return jwk;\n  }\n\n  /**\n   * @see https://datatracker.ietf.org/doc/html/rfc8037#appendix-A.3\n   *\n   * @returns {Promise<string>} JWK Thumbprint.\n   */\n  async jwkThumbprint() {\n    const publicKey = base64url.encode(this._publicKeyBuffer);\n    const serialized = `{\"crv\":\"Ed25519\",\"kty\":\"OKP\",\"x\":\"${publicKey}\"}`;\n    const data = new TextEncoder().encode(serialized);\n    return base64url.encode(\n      new Uint8Array(await ed25519.sha256digest({data})));\n  }\n\n  /**\n   * Returns the JsonWebKey2020 representation of this key pair.\n   *\n   * @see https://w3c-ccg.github.io/lds-jws2020/#json-web-key-2020\n   *\n   * @returns {Promise<object>} JsonWebKey2020 representation.\n   */\n  async toJsonWebKey2020() {\n    return {\n      '@context': 'https://w3id.org/security/jws/v1',\n      id: this.controller + '#' + await this.jwkThumbprint(),\n      type: 'JsonWebKey2020',\n      controller: this.controller,\n      publicKeyJwk: this.toJwk({publicKey: true})\n    };\n  }\n\n  /**\n   * Tests whether the fingerprint was generated from a given key pair.\n   *\n   * @example\n   * > edKeyPair.verifyFingerprint({fingerprint: 'z6Mk2S2Q...6MkaFJewa'});\n   * {valid: true};\n   *\n   * @param {object} options - Options hashmap.\n   * @param {string} options.fingerprint - A public key fingerprint.\n   *\n   * @returns {{valid: boolean, error: *}} Result of verification.\n   */\n  verifyFingerprint({fingerprint} = {}) {\n    // fingerprint should have multibase base58-btc header\n    if(!(typeof fingerprint === 'string' &&\n      fingerprint[0] === MULTIBASE_BASE58BTC_HEADER)) {\n      return {\n        error: new Error('\"fingerprint\" must be a multibase encoded string.'),\n        valid: false\n      };\n    }\n    let fingerprintBuffer;\n    try {\n      fingerprintBuffer = base58btc.decode(fingerprint.substr(1));\n      if(!fingerprintBuffer) {\n        throw new TypeError('Invalid encoding of fingerprint.');\n      }\n    } catch(e) {\n      return {error: e, valid: false};\n    }\n\n    const buffersEqual = _isEqualBuffer(this._publicKeyBuffer,\n      fingerprintBuffer.slice(2));\n\n    // validate the first two multicodec bytes\n    const valid =\n      fingerprintBuffer[0] === MULTICODEC_ED25519_PUB_HEADER[0] &&\n      fingerprintBuffer[1] === MULTICODEC_ED25519_PUB_HEADER[1] &&\n      buffersEqual;\n    if(!valid) {\n      return {\n        error: new Error('The fingerprint does not match the public key.'),\n        valid: false\n      };\n    }\n    return {valid};\n  }\n\n  signer() {\n    const privateKeyBuffer = this._privateKeyBuffer;\n\n    return {\n      async sign({data}) {\n        if(!privateKeyBuffer) {\n          throw new Error('A private key is not available for signing.');\n        }\n        return ed25519.sign(privateKeyBuffer, data);\n      },\n      id: this.id\n    };\n  }\n\n  verifier() {\n    const publicKeyBuffer = this._publicKeyBuffer;\n\n    return {\n      async verify({data, signature}) {\n        if(!publicKeyBuffer) {\n          throw new Error('A public key is not available for verifying.');\n        }\n        return ed25519.verify(publicKeyBuffer, data, signature);\n      },\n      id: this.id\n    };\n  }\n}\n// Used by CryptoLD harness for dispatching.\nEd25519VerificationKey2020.suite = SUITE_ID;\n// Used by CryptoLD harness's fromKeyId() method.\nEd25519VerificationKey2020.SUITE_CONTEXT =\n  'https://w3id.org/security/suites/ed25519-2020/v1';\n\n// check to ensure that two buffers are byte-for-byte equal\n// WARNING: this function must only be used to check public information as\n//          timing attacks can be used for non-constant time checks on\n//          secret information.\nfunction _isEqualBuffer(buf1, buf2) {\n  if(buf1.length !== buf2.length) {\n    return false;\n  }\n  for(let i = 0; i < buf1.length; i++) {\n    if(buf1[i] !== buf2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// check a multibase key for an expected header\nfunction _isValidKeyHeader(multibaseKey, expectedHeader) {\n  if(!(typeof multibaseKey === 'string' &&\n    multibaseKey[0] === MULTIBASE_BASE58BTC_HEADER)) {\n    return false;\n  }\n\n  const keyBytes = base58btc.decode(multibaseKey.slice(1));\n  return expectedHeader.every((val, i) => keyBytes[i] === val);\n}\n\n// encode a multibase base58-btc multicodec key\nfunction _encodeMbKey(header, key) {\n  const mbKey = new Uint8Array(header.length + key.length);\n\n  mbKey.set(header);\n  mbKey.set(key, header.length);\n\n  return MULTIBASE_BASE58BTC_HEADER + base58btc.encode(mbKey);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}