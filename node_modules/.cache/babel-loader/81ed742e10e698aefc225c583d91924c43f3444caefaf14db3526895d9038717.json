{"ast":null,"code":"/*!\n * Copyright (c) 2010-2018 Digital Bazaar, Inc. All rights reserved.\n */\n'use strict';\n\n/* Core API */\nconst api = {};\nmodule.exports = api;\n\n/* API Constants */\nconst constants = require('./constants');\nObject.assign(api, constants);\n\n// TODO: support `ProofChain`\nconst ProofSet = require('./ProofSet');\nconst VerificationError = require('./VerificationError');\n\n/**\n * Cryptographically signs the provided document by adding a `proof` section,\n * based on the provided suite and proof purpose.\n *\n * @param {object} document - The JSON-LD document to be signed.\n *\n * @param {object} options - Options hashmap.\n * @param {LinkedDataSignature} options.suite - The linked data signature\n *   cryptographic suite, containing private key material, with which to sign\n *   the document.\n *\n * @param {ProofPurpose} purpose - A proof purpose instance that will\n *   match proofs to be verified and ensure they were created according to\n *   the appropriate purpose.\n *\n * @param {function} documentLoader  - A secure document loader (it is\n *   recommended to use one that provides static known documents, instead of\n *   fetching from the web) for returning contexts, controller documents, keys,\n *   and other relevant URLs needed for the proof.\n *\n * Advanced optional parameters and overrides:\n *\n * @param {function} [options.expansionMap] - A custom expansion map that is\n *   passed to the JSON-LD processor; by default a function that will throw\n *   an error when unmapped properties are detected in the input, use `false`\n *   to turn this off and allow unmapped properties to be dropped or use a\n *   custom function.\n * @param {boolean} [options.addSuiteContext=true] - Toggles the default\n *   behavior of each signature suite enforcing the presence of its own\n *   `@context` (if it is not present, it's added to the context list).\n *\n * @returns {Promise<object>} Resolves with signed document.\n */\napi.sign = async function sign(document, {\n  suite,\n  purpose,\n  documentLoader,\n  expansionMap,\n  addSuiteContext = true\n} = {}) {\n  if (typeof document !== 'object') {\n    throw new TypeError('The \"document\" parameter must be an object.');\n  }\n  // Ensure document contains the signature suite specific context URL\n  // or throw an error (in case an advanced user overrides the `addSuiteContext`\n  // flag to false).\n  suite.ensureSuiteContext({\n    document,\n    addSuiteContext\n  });\n  try {\n    return await new ProofSet().add(document, {\n      suite,\n      purpose,\n      documentLoader,\n      expansionMap\n    });\n  } catch (e) {\n    if (!documentLoader && e.name === 'jsonld.InvalidUrl') {\n      const {\n        details: {\n          url\n        }\n      } = e;\n      const err = new Error(`A URL \"${url}\" could not be fetched; you need to pass ` + '\"documentLoader\" or resolve the URL before calling \"sign\".');\n      err.cause = e;\n      throw err;\n    }\n    throw e;\n  }\n};\n\n/**\n * Verifies the linked data signature on the provided document.\n *\n * @param {object} document - The JSON-LD document with one or more proofs to be\n *   verified.\n *\n * @param {LinkedDataSignature|LinkedDataSignature[]} suite -\n *   Acceptable signature suite instances for verifying the proof(s).\n *\n * @param {ProofPurpose} purpose - A proof purpose instance that will\n *   match proofs to be verified and ensure they were created according to\n *   the appropriate purpose.\n *\n * Advanced optional parameters and overrides:\n *\n * @param {function} [documentLoader]  - A custom document loader,\n *   `Promise<RemoteDocument> documentLoader(url)`.\n * @param {function} [expansionMap] - A custom expansion map that is\n *   passed to the JSON-LD processor; by default a function that will throw\n *   an error when unmapped properties are detected in the input, use `false`\n *   to turn this off and allow unmapped properties to be dropped or use a\n *   custom function.\n *\n * @return {Promise<{verified: boolean, results: Array,\n *   error: VerificationError}>}\n *   resolves with an object with a `verified` boolean property that is `true`\n *   if at least one proof matching the given purpose and suite verifies and\n *   `false` otherwise; a `results` property with an array of detailed results;\n *   if `false` an `error` property will be present, with `error.errors`\n *   containing all of the errors that occurred during the verification process.\n */\napi.verify = async function verify(document, {\n  suite,\n  purpose,\n  documentLoader,\n  expansionMap\n} = {}) {\n  if (typeof document !== 'object') {\n    throw new TypeError('The \"document\" parameter must be an object.');\n  }\n  const result = await new ProofSet().verify(document, {\n    suite,\n    purpose,\n    documentLoader,\n    expansionMap\n  });\n  const {\n    error\n  } = result;\n  if (error) {\n    if (!documentLoader && error.name === 'jsonld.InvalidUrl') {\n      const {\n        details: {\n          url\n        }\n      } = error;\n      const urlError = new Error(`A URL \"${url}\" could not be fetched; you need to pass ` + '\"documentLoader\" or resolve the URL before calling \"verify\".');\n      result.error = new VerificationError(urlError);\n    } else {\n      result.error = new VerificationError(error);\n    }\n  }\n  return result;\n};\n\n// expose suite classes\napi.suites = require('./suites').suites;\n\n// expose ProofPurpose classes to enable extensions\napi.purposes = require('./purposes').purposes;\n\n// expose document loader helpers\nObject.assign(api, require('./documentLoader'));","map":{"version":3,"names":["api","module","exports","constants","require","Object","assign","ProofSet","VerificationError","sign","document","suite","purpose","documentLoader","expansionMap","addSuiteContext","TypeError","ensureSuiteContext","add","e","name","details","url","err","Error","cause","verify","result","error","urlError","suites","purposes"],"sources":["/home/pratap/hid-ssi-js-sdk/node_modules/jsonld-signatures/lib/jsonld-signatures.js"],"sourcesContent":["/*!\n * Copyright (c) 2010-2018 Digital Bazaar, Inc. All rights reserved.\n */\n'use strict';\n\n/* Core API */\nconst api = {};\nmodule.exports = api;\n\n/* API Constants */\nconst constants = require('./constants');\nObject.assign(api, constants);\n\n// TODO: support `ProofChain`\nconst ProofSet = require('./ProofSet');\nconst VerificationError = require('./VerificationError');\n\n/**\n * Cryptographically signs the provided document by adding a `proof` section,\n * based on the provided suite and proof purpose.\n *\n * @param {object} document - The JSON-LD document to be signed.\n *\n * @param {object} options - Options hashmap.\n * @param {LinkedDataSignature} options.suite - The linked data signature\n *   cryptographic suite, containing private key material, with which to sign\n *   the document.\n *\n * @param {ProofPurpose} purpose - A proof purpose instance that will\n *   match proofs to be verified and ensure they were created according to\n *   the appropriate purpose.\n *\n * @param {function} documentLoader  - A secure document loader (it is\n *   recommended to use one that provides static known documents, instead of\n *   fetching from the web) for returning contexts, controller documents, keys,\n *   and other relevant URLs needed for the proof.\n *\n * Advanced optional parameters and overrides:\n *\n * @param {function} [options.expansionMap] - A custom expansion map that is\n *   passed to the JSON-LD processor; by default a function that will throw\n *   an error when unmapped properties are detected in the input, use `false`\n *   to turn this off and allow unmapped properties to be dropped or use a\n *   custom function.\n * @param {boolean} [options.addSuiteContext=true] - Toggles the default\n *   behavior of each signature suite enforcing the presence of its own\n *   `@context` (if it is not present, it's added to the context list).\n *\n * @returns {Promise<object>} Resolves with signed document.\n */\napi.sign = async function sign(document, {\n  suite, purpose, documentLoader, expansionMap, addSuiteContext = true\n} = {}) {\n  if(typeof document !== 'object') {\n    throw new TypeError('The \"document\" parameter must be an object.');\n  }\n  // Ensure document contains the signature suite specific context URL\n  // or throw an error (in case an advanced user overrides the `addSuiteContext`\n  // flag to false).\n  suite.ensureSuiteContext({document, addSuiteContext});\n\n  try {\n    return await new ProofSet().add(\n      document, {suite, purpose, documentLoader, expansionMap});\n  } catch(e) {\n    if(!documentLoader && e.name === 'jsonld.InvalidUrl') {\n      const {details: {url}} = e;\n      const err = new Error(\n        `A URL \"${url}\" could not be fetched; you need to pass ` +\n        '\"documentLoader\" or resolve the URL before calling \"sign\".');\n      err.cause = e;\n      throw err;\n    }\n    throw e;\n  }\n};\n\n/**\n * Verifies the linked data signature on the provided document.\n *\n * @param {object} document - The JSON-LD document with one or more proofs to be\n *   verified.\n *\n * @param {LinkedDataSignature|LinkedDataSignature[]} suite -\n *   Acceptable signature suite instances for verifying the proof(s).\n *\n * @param {ProofPurpose} purpose - A proof purpose instance that will\n *   match proofs to be verified and ensure they were created according to\n *   the appropriate purpose.\n *\n * Advanced optional parameters and overrides:\n *\n * @param {function} [documentLoader]  - A custom document loader,\n *   `Promise<RemoteDocument> documentLoader(url)`.\n * @param {function} [expansionMap] - A custom expansion map that is\n *   passed to the JSON-LD processor; by default a function that will throw\n *   an error when unmapped properties are detected in the input, use `false`\n *   to turn this off and allow unmapped properties to be dropped or use a\n *   custom function.\n *\n * @return {Promise<{verified: boolean, results: Array,\n *   error: VerificationError}>}\n *   resolves with an object with a `verified` boolean property that is `true`\n *   if at least one proof matching the given purpose and suite verifies and\n *   `false` otherwise; a `results` property with an array of detailed results;\n *   if `false` an `error` property will be present, with `error.errors`\n *   containing all of the errors that occurred during the verification process.\n */\napi.verify = async function verify(document, {\n  suite, purpose, documentLoader, expansionMap} = {}) {\n  if(typeof document !== 'object') {\n    throw new TypeError('The \"document\" parameter must be an object.');\n  }\n  const result = await new ProofSet().verify(\n    document, {suite, purpose, documentLoader, expansionMap});\n  const {error} = result;\n  if(error) {\n    if(!documentLoader && error.name === 'jsonld.InvalidUrl') {\n      const {details: {url}} = error;\n      const urlError = new Error(\n        `A URL \"${url}\" could not be fetched; you need to pass ` +\n        '\"documentLoader\" or resolve the URL before calling \"verify\".');\n      result.error = new VerificationError(urlError);\n    } else {\n      result.error = new VerificationError(error);\n    }\n  }\n  return result;\n};\n\n// expose suite classes\napi.suites = require('./suites').suites;\n\n// expose ProofPurpose classes to enable extensions\napi.purposes = require('./purposes').purposes;\n\n// expose document loader helpers\nObject.assign(api, require('./documentLoader'));\n\n"],"mappings":"AAAA;AACA;AACA;AACA,YAAY;;AAEZ;AACA,MAAMA,GAAG,GAAG,CAAC,CAAC;AACdC,MAAM,CAACC,OAAO,GAAGF,GAAG;;AAEpB;AACA,MAAMG,SAAS,GAAGC,OAAO,CAAC,aAAa,CAAC;AACxCC,MAAM,CAACC,MAAM,CAACN,GAAG,EAAEG,SAAS,CAAC;;AAE7B;AACA,MAAMI,QAAQ,GAAGH,OAAO,CAAC,YAAY,CAAC;AACtC,MAAMI,iBAAiB,GAAGJ,OAAO,CAAC,qBAAqB,CAAC;;AAExD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAJ,GAAG,CAACS,IAAI,GAAG,eAAeA,IAAIA,CAACC,QAAQ,EAAE;EACvCC,KAAK;EAAEC,OAAO;EAAEC,cAAc;EAAEC,YAAY;EAAEC,eAAe,GAAG;AAClE,CAAC,GAAG,CAAC,CAAC,EAAE;EACN,IAAG,OAAOL,QAAQ,KAAK,QAAQ,EAAE;IAC/B,MAAM,IAAIM,SAAS,CAAC,6CAA6C,CAAC;EACpE;EACA;EACA;EACA;EACAL,KAAK,CAACM,kBAAkB,CAAC;IAACP,QAAQ;IAAEK;EAAe,CAAC,CAAC;EAErD,IAAI;IACF,OAAO,MAAM,IAAIR,QAAQ,CAAC,CAAC,CAACW,GAAG,CAC7BR,QAAQ,EAAE;MAACC,KAAK;MAAEC,OAAO;MAAEC,cAAc;MAAEC;IAAY,CAAC,CAAC;EAC7D,CAAC,CAAC,OAAMK,CAAC,EAAE;IACT,IAAG,CAACN,cAAc,IAAIM,CAAC,CAACC,IAAI,KAAK,mBAAmB,EAAE;MACpD,MAAM;QAACC,OAAO,EAAE;UAACC;QAAG;MAAC,CAAC,GAAGH,CAAC;MAC1B,MAAMI,GAAG,GAAG,IAAIC,KAAK,CAClB,UAASF,GAAI,2CAA0C,GACxD,4DAA4D,CAAC;MAC/DC,GAAG,CAACE,KAAK,GAAGN,CAAC;MACb,MAAMI,GAAG;IACX;IACA,MAAMJ,CAAC;EACT;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAnB,GAAG,CAAC0B,MAAM,GAAG,eAAeA,MAAMA,CAAChB,QAAQ,EAAE;EAC3CC,KAAK;EAAEC,OAAO;EAAEC,cAAc;EAAEC;AAAY,CAAC,GAAG,CAAC,CAAC,EAAE;EACpD,IAAG,OAAOJ,QAAQ,KAAK,QAAQ,EAAE;IAC/B,MAAM,IAAIM,SAAS,CAAC,6CAA6C,CAAC;EACpE;EACA,MAAMW,MAAM,GAAG,MAAM,IAAIpB,QAAQ,CAAC,CAAC,CAACmB,MAAM,CACxChB,QAAQ,EAAE;IAACC,KAAK;IAAEC,OAAO;IAAEC,cAAc;IAAEC;EAAY,CAAC,CAAC;EAC3D,MAAM;IAACc;EAAK,CAAC,GAAGD,MAAM;EACtB,IAAGC,KAAK,EAAE;IACR,IAAG,CAACf,cAAc,IAAIe,KAAK,CAACR,IAAI,KAAK,mBAAmB,EAAE;MACxD,MAAM;QAACC,OAAO,EAAE;UAACC;QAAG;MAAC,CAAC,GAAGM,KAAK;MAC9B,MAAMC,QAAQ,GAAG,IAAIL,KAAK,CACvB,UAASF,GAAI,2CAA0C,GACxD,8DAA8D,CAAC;MACjEK,MAAM,CAACC,KAAK,GAAG,IAAIpB,iBAAiB,CAACqB,QAAQ,CAAC;IAChD,CAAC,MAAM;MACLF,MAAM,CAACC,KAAK,GAAG,IAAIpB,iBAAiB,CAACoB,KAAK,CAAC;IAC7C;EACF;EACA,OAAOD,MAAM;AACf,CAAC;;AAED;AACA3B,GAAG,CAAC8B,MAAM,GAAG1B,OAAO,CAAC,UAAU,CAAC,CAAC0B,MAAM;;AAEvC;AACA9B,GAAG,CAAC+B,QAAQ,GAAG3B,OAAO,CAAC,YAAY,CAAC,CAAC2B,QAAQ;;AAE7C;AACA1B,MAAM,CAACC,MAAM,CAACN,GAAG,EAAEI,OAAO,CAAC,kBAAkB,CAAC,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}